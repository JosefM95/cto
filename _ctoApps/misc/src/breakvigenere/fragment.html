<div class="cryptool-container container">
    <form id="parameters">
        <!-- start content -->


        <!-- style="margin-left: 21px;" -->
        <br>
        <table class="contentpaneopen">
            <tbody>
            <tr>
                <td valign="top">
                    <div class="text12" align="left">Die Schalter SW1 und SW2 regeln die Feineinstellung für die Analyse.</div>
                    <div class="text12" align="left"><br />Der Schwellwert für zulässige Werte für die Auswertung liegt SW1[%] über dem arithmetischen Mittelwert, zuzüglich eines Offsets von (SW2) über letzterem.</div>
                    <div class="text12" align="left"><br />Der Schalter SW3 regelt die Länge der Fragmente, die mittels Autokorrelation untersucht werden. Die Ergebnisse werden überlagert.</div>            </td>
            </tr>
            </tbody>
        </table>
        <br /><div id="cto-tool-data">

        <form action="" name="formular" method="post">
            <table border=0>
                <tr>
                    <td>
                        Anzahl Geheimtextzeichen: <span id="count">0</span>
                    </td>
                </tr>
                <tr>
                    <td>
                        <textarea id=codtxt class="ctoformcss-txtinput-style ctoformcss-default-input-size" wrap=virtual></textarea>
                    </td>
                    <td></td>
                </tr>
                <tr>
                    <td colspan=2>SW1:
                        <select id="schw1">1.3<option value="0.5">-50%</option><option value="0.6">-40%</option><option value="0.7">-30%</option><option value="0.8">-20%</option><option value="0.9">-10%</option><option value="1">0%</option><option value="1.1">10%</option><option value="1.2">20%</option><option value="1.3" SELECTED >30%</option><option value="1.4">40%</option><option value="1.5">50%</option><option value="1.6">60%</option><option value="1.7">70%</option><option value="1.8">80%</option><option value="1.9">90%</option><option value="2">100%</option>
                        </select>&nbsp;&nbsp;
                        SW2:
                        <select id="schw2">1<option value="1" SELECTED >+1</option><option value="2">+2</option><option value="3">+3</option><option value="4">+4</option><option value="5">+5</option><option value="6">+6</option><option value="7">+7</option><option value="8">+8</option><option value="9">+9</option><option value="10">+10</option><option value="11">+11</option><option value="12">+12</option><option value="13">+13</option><option value="14">+14</option><option value="15">+15</option><option value="16">+16</option><option value="17">+17</option><option value="18">+18</option><option value="19">+19</option><option value="20">+20</option>
                        </select>&nbsp;&nbsp;
                        SW3:
                        <select id="siz"><option value=50>50 </option><option value=60>60 </option><option value=70>70 </option><option value=80>80 </option><option value=90>90 </option><option value=100>100 </option><option value=110>110 </option><option value=120>120 </option><option value=130>130 </option><option value=140>140 </option><option value=150 SELECTED >150 </option><option value=160>160 </option><option value=170>170 </option><option value=180>180 </option><option value=190>190 </option><option value=200>200 </option><option value=210>210 </option><option value=220>220 </option><option value=230>230 </option><option value=240>240 </option><option value=250>250 </option><option value=260>260 </option><option value=270>270 </option><option value=280>280 </option><option value=290>290 </option><option value=300>300 </option><option value=310>310 </option><option value=320>320 </option><option value=330>330 </option><option value=340>340 </option><option value=350>350 </option><option value=360>360 </option><option value=370>370 </option><option value=380>380 </option><option value=390>390 </option><option value=400>400 </option><option value=410>410 </option><option value=420>420 </option><option value=430>430 </option><option value=440>440 </option><option value=450>450 </option><option value=460>460 </option><option value=470>470 </option><option value=480>480 </option><option value=490>490 </option><option value=500>500 </option><option value=510>510 </option><option value=520>520 </option><option value=530>530 </option><option value=540>540 </option><option value=550>550 </option><option value=560>560 </option><option value=570>570 </option><option value=580>580 </option><option value=590>590 </option><option value=600>600 </option><option value=610>610 </option><option value=620>620 </option><option value=630>630 </option><option value=640>640 </option><option value=650>650 </option><option value=660>660 </option><option value=670>670 </option><option value=680>680 </option><option value=690>690 </option><option value=700>700 </option><option value=710>710 </option><option value=720>720 </option><option value=730>730 </option><option value=740>740 </option><option value=750>750 </option><option value=760>760 </option><option value=770>770 </option><option value=780>780 </option><option value=790>790 </option><option value=800>800 </option><option value=810>810 </option><option value=820>820 </option><option value=830>830 </option><option value=840>840 </option><option value=850>850 </option><option value=860>860 </option><option value=870>870 </option><option value=880>880 </option><option value=890>890 </option><option value=900>900 </option><option value=910>910 </option><option value=920>920 </option><option value=930>930 </option><option value=940>940 </option><option value=950>950 </option><option value=960>960 </option><option value=970>970 </option><option value=980>980 </option><option value=990>990 </option><option value=1000>1000 </option>
                        </select>&nbsp;&nbsp;
                        sect:<select id="sect"><option value=200>200 </option><option value=250>250 </option><option value=300>300 </option><option value=350>350 </option><option value=400>400 </option><option value=450>450 </option><option value=500>500 </option><option value=550>550 </option><option value=600>600 </option><option value=650>650 </option><option value=700>700 </option><option value=750>750 </option><option value=800>800 </option><option value=850>850 </option><option value=900>900 </option><option value=950>950 </option><option value=1000 SELECTED >1000 </option><option value=1050>1050 </option><option value=1100>1100 </option><option value=1150>1150 </option><option value=1200>1200 </option><option value=1250>1250 </option><option value=1300>1300 </option><option value=1350>1350 </option><option value=1400>1400 </option><option value=1450>1450 </option><option value=1500>1500 </option><option value=1550>1550 </option><option value=1600>1600 </option><option value=1650>1650 </option><option value=1700>1700 </option><option value=1750>1750 </option><option value=1800>1800 </option><option value=1850>1850 </option><option value=1900>1900 </option><option value=1950>1950 </option><option value=2000>2000 </option><option value=2050>2050 </option><option value=2100>2100 </option><option value=2150>2150 </option><option value=2200>2200 </option><option value=2250>2250 </option><option value=2300>2300 </option><option value=2350>2350 </option><option value=2400>2400 </option><option value=2450>2450 </option><option value=2500>2500 </option><option value=2550>2550 </option><option value=2600>2600 </option><option value=2650>2650 </option><option value=2700>2700 </option><option value=2750>2750 </option><option value=2800>2800 </option><option value=2850>2850 </option><option value=2900>2900 </option><option value=2950>2950 </option><option value=3000>3000 </option><option value=3050>3050 </option><option value=3100>3100 </option><option value=3150>3150 </option><option value=3200>3200 </option><option value=3250>3250 </option><option value=3300>3300 </option><option value=3350>3350 </option><option value=3400>3400 </option><option value=3450>3450 </option><option value=3500>3500 </option><option value=3550>3550 </option><option value=3600>3600 </option><option value=3650>3650 </option><option value=3700>3700 </option><option value=3750>3750 </option><option value=3800>3800 </option><option value=3850>3850 </option><option value=3900>3900 </option><option value=3950>3950 </option><option value=4000>4000 </option><option value=4050>4050 </option><option value=4100>4100 </option><option value=4150>4150 </option><option value=4200>4200 </option><option value=4250>4250 </option><option value=4300>4300 </option><option value=4350>4350 </option><option value=4400>4400 </option><option value=4450>4450 </option><option value=4500>4500 </option><option value=4550>4550 </option><option value=4600>4600 </option><option value=4650>4650 </option><option value=4700>4700 </option><option value=4750>4750 </option><option value=4800>4800 </option><option value=4850>4850 </option><option value=4900>4900 </option><option value=4950>4950 </option><option value=5000>5000 </option><option value=5050>5050 </option><option value=5100>5100 </option><option value=5150>5150 </option><option value=5200>5200 </option><option value=5250>5250 </option><option value=5300>5300 </option><option value=5350>5350 </option><option value=5400>5400 </option><option value=5450>5450 </option><option value=5500>5500 </option><option value=5550>5550 </option><option value=5600>5600 </option><option value=5650>5650 </option><option value=5700>5700 </option><option value=5750>5750 </option><option value=5800>5800 </option><option value=5850>5850 </option><option value=5900>5900 </option><option value=5950>5950 </option><option value=6000>6000 </option><option value=6050>6050 </option><option value=6100>6100 </option><option value=6150>6150 </option><option value=6200>6200 </option><option value=6250>6250 </option><option value=6300>6300 </option><option value=6350>6350 </option><option value=6400>6400 </option><option value=6450>6450 </option><option value=6500>6500 </option><option value=6550>6550 </option><option value=6600>6600 </option><option value=6650>6650 </option><option value=6700>6700 </option><option value=6750>6750 </option><option value=6800>6800 </option><option value=6850>6850 </option><option value=6900>6900 </option><option value=6950>6950 </option><option value=7000>7000 </option><option value=7050>7050 </option><option value=7100>7100 </option><option value=7150>7150 </option><option value=7200>7200 </option><option value=7250>7250 </option><option value=7300>7300 </option><option value=7350>7350 </option><option value=7400>7400 </option><option value=7450>7450 </option><option value=7500>7500 </option><option value=7550>7550 </option><option value=7600>7600 </option><option value=7650>7650 </option><option value=7700>7700 </option><option value=7750>7750 </option><option value=7800>7800 </option><option value=7850>7850 </option><option value=7900>7900 </option><option value=7950>7950 </option><option value=8000>8000 </option><option value=8050>8050 </option><option value=8100>8100 </option><option value=8150>8150 </option><option value=8200>8200 </option><option value=8250>8250 </option><option value=8300>8300 </option><option value=8350>8350 </option><option value=8400>8400 </option><option value=8450>8450 </option><option value=8500>8500 </option><option value=8550>8550 </option><option value=8600>8600 </option><option value=8650>8650 </option><option value=8700>8700 </option><option value=8750>8750 </option><option value=8800>8800 </option><option value=8850>8850 </option><option value=8900>8900 </option><option value=8950>8950 </option><option value=9000>9000 </option><option value=9050>9050 </option><option value=9100>9100 </option><option value=9150>9150 </option><option value=9200>9200 </option><option value=9250>9250 </option><option value=9300>9300 </option><option value=9350>9350 </option><option value=9400>9400 </option><option value=9450>9450 </option><option value=9500>9500 </option><option value=9550>9550 </option><option value=9600>9600 </option><option value=9650>9650 </option><option value=9700>9700 </option><option value=9750>9750 </option><option value=9800>9800 </option><option value=9850>9850 </option><option value=9900>9900 </option><option value=9950>9950 </option><option value=10000>10000 </option>
                        </select>
                        <p><input type=button name=suchen value="Break Vigenère" onclick="return go()" class="ctoformcss-default-button-m">
                    </td>
                </tr>
            </table>
        </form><br></div>
        <table id="author_footer">
            <tr>
                <td>
                    <hr />
                    <font size='1'>
                        CTOAUTHOR: Marcel Brätz, Christian Sieche	   </font>
                </td>
            </tr>
        </table><div class="floatingCirclesG">
        <div class="f_circleG" id="frotateG_01">
        </div>
        <div class="f_circleG" id="frotateG_02">
        </div>
        <div class="f_circleG" id="frotateG_03">
        </div>
        <div class="f_circleG" id="frotateG_04">
        </div>
        <div class="f_circleG" id="frotateG_05">
        </div>
        <div class="f_circleG" id="frotateG_06">
        </div>
        <div class="f_circleG" id="frotateG_07">
        </div>
        <div class="f_circleG" id="frotateG_08">
        </div>
    </div>


</div>
<!-- end content -->

</form>
</div>

<script>
    function go() {
        var e = document.getElementById("schw1");
        var schw1 = e.options[e.selectedIndex].value;


        var e2 = document.getElementById("schw2");
        var schw2 = e2.options[e2.selectedIndex].value;

        e = document.getElementById("siz");
        var siz = e.options[e.selectedIndex].value;

        e = document.getElementById("sect");
        var sect = e.options[e.selectedIndex].value;

        var codtxt = document.getElementById("codtxt").value;
        codtxt = codtxt.replace(/[^A-Za-z]/g, "");
        codtxt = codtxt.toUpperCase();
        document.getElementById("count").innerHTML = codtxt.length;

        var parttxt = codtxt.substr(0, sect);

        var arr = ak_akt(codtxt, siz);
        //alert(arr);

        /*var width;
        var spac;

        if(arr.length <= 50) {
            width = 4;
            spac = 3;
        }
        if(arr.length > 50) {
            width = 3;
            spac = 2;
        }
        if(arr.length > 100) {
            width = 2;
            spac = 1;
        }
        if(arr.length > 200) {
            width = 2;
            spac = 0;
        }
        if(arr.length > 400) {
            width = 1;
            spac = 0;
        }*/

        var arr2 = filterakt(arr, schw1, schw2);

        var zahl = keylen(arr); //<-- bug

        var passwd = findpw(parttxt, zahl);

    }

    function findpw (text, pw1) {
        var alpha = ["A", "B", "C", "D", "E", "F", "G", "H", "I", "J", "K", "L", "M", "N", "O", "P", "Q", "R", "S", "T", "U", "V", "W", "X", "Y", "Z"];
        var texte = trennen(text, pw1);

        var rot = [];
        var pass = "";

        for(var i = 0; i < texte.length; i++) {
            rot[i] = findrot(texte[i]);
            pass += buchstabeVonIndex(alpha, rot[i]);
        }

        return pass;
    }

    function str_splitt (text) {
        var arr = [];
        for(var i = 0; i < text.length; i++) {
            arr[i] = text.substr(i, 1);
        }

        return arr;
    }

    function trennen (text, num) {
        var txt = str_splitt(text);
        var strngs = [];
        for(var i = 0; i < txt.length; i++) {
            strngs[i%num] = '';
        }
        for(var i = 0; i < txt.length; i++) {
            strngs[i%num] += txt[i];
        }


        return strngs;
    }

    function buchstabeVonIndex (alpha, index) {
        return alpha[index];
    }

    function indexVonBuchstabe (alpha, letter) {
        for(var i = 0; i < alpha.length; i++) {
            if(letter == alpha[i]) {
                return i;
                break;
            }
        }
    }

    function findrot (text) {
        var AP = [6.47, 1.93, 2.68, 4.83,17.48, 1.65, 3.06, 4.23, 7.73, 0.27, 1.46, 3.49, 2.58, 9.84, 2.98, 0.96, 0.02, 7.54, 6.83, 6.13, 4.17, 0.94, 1.49, 0.04, 0.08, 1.14];
        var alpha = ["A", "B", "C", "D", "E", "F", "G", "H", "I", "J", "K", "L", "M", "N", "O", "P", "Q", "R", "S", "T", "U", "V", "W", "X", "Y", "Z"];

        var VX = varianz(AP);
        var VY;
        var SX = Math.sqrt(varianz(AP));
        var SY;
        var sp = hauf(text);
        var sps = sp.reduce(function(pv, cv) { return pv + cv; }, 0);
        var sp2 = [];
        var cov;
        var r = [];

        for(var i = 0; i < sp.length; i++) {
            sp[i] = Math.round(sp[i]/sps*100);
            sp[i] = Math.round(sp[i] * 100) / 100;

        }

        for(var i = 0; i < sp.length; i++) {
            for(var j = 0; j < sp.length; j++) {
                sp2[j] = sp[(i+j)%sp.length];
            }
            VY = varianz(sp2);
            SY = Math.sqrt(varianz(sp2));
            cov = covarianz(AP, sp2);
            r[i] = Math.abs(cov/Math.sqrt(VX*VY));
        }

        var b = indexOfMax(r);

        return b;

    }

    function hauf (text) {
        var alpha = ["A", "B", "C", "D", "E", "F", "G", "H", "I", "J", "K", "L", "M", "N", "O", "P", "Q", "R", "S", "T", "U", "V", "W", "X", "Y", "Z"];
        var hauf = [];

        for(var i = 0; i < alpha.length; i++) {
            hauf[i] = 0;
        }

        var zeichen;
        var index;

        for(var i = 0; i < text.length; i++) {
            zeichen = text.substr(i, 1);
            index = indexVonBuchstabe(alpha, zeichen);
            hauf[index] = (hauf[index] + 1);
        }

        return hauf;


    }

    function indexOfMax (arr) {
        if (arr.length === 0) {
            return -1;
        }

        var max = arr[0];
        var maxIndex = 0;

        for (var i = 1; i < arr.length; i++) {
            if (arr[i] > max) {
                maxIndex = i;
                max = arr[i];
            }
        }

        return maxIndex;
    }

    function varianz (arr) {
        var x = mittelwert(arr);
        var n;
        var m;
        var summe = 0;

        for(var i = 0; i < arr.length; i++) {
            n = arr[i];
            m = ((n-x))*((n-x));
            summe += m;
        }

        return (summe / arr.length);
    }

    function covarianz (arr, arr2) {
        var x = mittelwert(arr);
        var y = mittelwert(arr2);
        var summe = 0;

        if(arr.length != arr2.length) {
            alert("error");
            return 0;
        }
        for(var i = 0; i < arr.length; i++) {
            summe += (arr[i] - x) * (arr2[i] - y);
        }

        return (summe / arr.length);
    }

    function mittelwert ( arr) {
        var summe = 0;

        for(var i = 0; i < arr.length; i++) {
            summe += arr[i];
        }

        return (summe/arr.length);
    }


    function akt (text) {
        var arr1 = str_splitt(text);
        var sa1 = arr1.length;
        var arr2 = [];

        for(var i = 0; i < sa1/2; i++) {
            arr2[i] = 0;
        }

        var sa2 = arr2.length;

        var summe;

        for(var i = 0; i < (sa1/2); i++) {
            summe = 0;

            for(var j = 0; j < (sa1/2); j++) {
                if(arr1[j] == arr1[(j+i)%sa1]) {
                    summe++;
                }
            }
            arr2[i] = summe;
        }
        var arr2Sum = arr2.reduce(function(pv, cv) { return pv + cv; }, 0);
        var am = arr2Sum / sa2;

        for(var i = 0; i < sa1; i++) {
            if(arr2[i] > 3*am)
                arr2[i] = 4*am;
        }

        return arr2;
    }

    function ak_akt (text, siz) {
        var n = text.length / siz;
        var z;
        var txt;
        var arr_tmp;
        var sat;
        var arr2 = [];

        for(var i = 0; i < n; i++) {
            z = (i*siz);
            txt = text.substr(z, siz);
            arr_tmp = akt(txt);
            sat = arr_tmp.length;

            for(var t = 0; t < sat; t++) {
                if(i == 0)
                    arr2[t] = '';
            }

            for(var j = 0; j < sat; j++) {
                arr2[j] = +arr2[j] + +arr_tmp[j];
            }
        }

        var arr2Sum = arr2.reduce(function(pv, cv) { return pv + cv; }, 0);
        var am = arr2Sum / arr2.length;
        var sa2 = arr2.length;

        for(var i = 0; i < sa2; i++) {
            if(arr2[i] > 3*am)
                arr2[i] = 4*am;
        }

        return arr2;
    }

    function keylen (arr) {
        var pos = 0;
        var tmp = [];

        for(var i = 0; i < arr.length; i++) {
            tmp[i] = 0;
        }


        for(var i = 0; i < arr.length / 2; i++) {

            if(arr[i] > 0) {
                tmp[i-pos]++;
                pos = i;
            }
        }

        var arr2 = [];
        for(var i = 0; i < tmp.length; i++) {
            arr2[i] = 0;
        }

        return indexOfMax(tmp);
    }

    function filterakt (arr2, schw1, schw2) {
        var arr2Sum = arr2.reduce(function(pv, cv) { return pv + cv; }, 0);
        var am = arr2Sum / arr2.length;
        var sa2 = arr2.length;
        var wert;
        var arr = [];

        for(var i = 0; i < sa2; i++) {
            switch (((arr2[i] - am*schw1))>= schw2) {
                case 1:
                    wert = 100;
                    break;

                default:
                    wert = 0;
                    break;
            }
            arr[i] = wert;
        }

        return arr;

    }

</script>
