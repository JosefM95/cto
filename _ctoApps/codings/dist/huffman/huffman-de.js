"use strict";function _toConsumableArray(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};window.addEventListener("load",function(){function e(){var e={},t=null;this.padStringWithLeadingZeros=function(e,t){for(var n=e;n.length<t;)n="0"+n;return n},this.frequency=function(e){var t={};for(var n in e)void 0==t[e[n]]?t[e[n]]=1:t[e[n]]=t[e[n]]+1;return t};var n=function(e,t){return e[0]!=t[0]?e[0]-t[0]:e[1].localeCompare(t[1])},r=function(e,t){return e[0]!=t[0]?e[0]-t[0]:e[1]-t[1]};this.sortfreq=function(e){var t=[];for(var r in e)t.push([e[r],r]);return t.sort(n)},this.buildtree=function(e){for(;e.length>1;){var t=[e[0][1],e[1][1]],n=e.slice(2,e.length),i=e[0][0]+e[1][0];e=n;var a=[i,t];e.push(a),e.sort(r)}return e},this.trimtree=function(e){return e[0][1]},this.assigncodes=function(t,n){n=n||"",(void 0===t?"undefined":_typeof(t))==_typeof("")?e[t]=n:(this.assigncodes(t[0],n+"0"),this.assigncodes(t[1],n+"1"))},this.encode=function(t){var n="";for(var r in t)n+=e[t[r]];return n},this.decode=function(e,t){var n="",r=e;for(var i in t)r=0==t[i]?r[0]:r[1],(void 0===r?"undefined":_typeof(r))==_typeof("")&&(n+=r,r=e);return n},this.encode_ascii=function(e){for(var t="",n=0;n<e.length;n++)t.length>0&&(t+=" "),t+=this.padStringWithLeadingZeros((e.charCodeAt(n)>>>0).toString(2),8);return t},this.decode_ascii=function(e){var t="";for(e=e.replace(/[^0-1]+/g,"");e.length>=8;){var n=e.substr(0,8),r=parseInt(n,2).toString(10);t+=String.fromCharCode(r),e=e.substr(8,e.length-8)}return t},this.getFrequencies=function(e){return[].concat(_toConsumableArray(new Set(e))).map(function(t){return e.match(new RegExp(t,"g")).length})},this.get_relative_frequencies=function(e,t){for(var n=[],r=e.length,i=0;i<t.length;i++)n.push(t[i]/r);return n},this.code_length_huff=function(t){for(var n=0,r=this.getFrequencies(t),i=this.get_relative_frequencies(t,r),a=Object.entries(e),o=0;o<a.length;o++)n+=i[o]*a[o][1].length;return n},this.code_length_ascii=function(e){for(var t=0,n=this.getFrequencies(e),r=this.get_relative_frequencies(e,n),i=0;i<n.length;i++)t+=8*r[i];return t},this.calculate_entropy=function(e){return this.getFrequencies(e).reduce(function(t,n){var r=n/e.length;return t-r*Math.log(r)/Math.log(2)},0)},this.build_table=function(e,t){for(var n=this.calculate_entropy(e),r=this.code_length_huff(e),i=this.code_length_ascii(e),a=[].concat(_toConsumableArray(new Set(e))),o=this.getFrequencies(e),s="",l=0;l<a.length;l++)s=s+"<tr><td>"+l.toString()+"</td><td>"+a[l]+"</td><td>"+a[l].charCodeAt(0)+"</td><td>"+o[l]+"</td><td>"+this.encode(a[l])+"</td><td>"+this.encode_ascii(a[l])+"</td></tr>";return'<table border="0"><tbody><tr><td><h2>AUSWERTUNG</h2><br><b>SPEICHERPLATZ:</b><blockquote>ASCII: '+(8*e.length).toString()+" bit<br>Huffman: "+t.length.toString()+" bit<br></blockquote><b>ENTROPIE:</b><blockquote>ASCII: "+n.toString()+"<br>Huffman: "+n.toString()+"<br></blockquote><b>CODE-LÄNGE:</b><blockquote>ASCII: "+i.toString()+" bit<br>Huffman: "+r.toString()+" bit<br></blockquote><b>KOMPRESSION:</b> "+(r/8).toString()+'<br><br><table cellspacing="0" cellpadding="4" border="1"><tbody><tr><td><b>&nbsp;NUMMER&nbsp;</b></td><td><b>&nbsp;ZEICHEN&nbsp;</b></td><td><b>&nbsp;ASCII&nbsp;</b></td><td><b>&nbsp;HÄUFIGKEIT&nbsp;</b></td><td><b>&nbsp;HUFFMAN&nbsp;</b></td><td><b>&nbsp;ASCII&nbsp;</b></td></tr>'+s+"</tbody></table></td></tr></tbody></table><br>"},this.encrypt=function(n,r){if(r.length>1){var i=this.frequency(r,t);console.log("freq:",this.sortfreq(i)),t=this.trimtree(this.buildtree(this.sortfreq(i))),this.assigncodes(t);var a=this.encode(r);return document.getElementById("ascii_encode").value=this.encode_ascii(r),document.getElementById("calculated").innerHTML=this.build_table(r,a),e={},a}return document.getElementById("ascii_encode").value="",document.getElementById("calculated").innerHTML="",""},this.decrypt=function(e,n){return this.decode(t,n)}}function t(e,t,n){this.algo=e,this.state=t,this.opts=n,this.charToValue=function(e,t){for(var n=t.length,r=0;r<n;++r){var i=t[r].getElementsByClassName("alphabet")[0].value,a=parseInt(t[r].getElementsByClassName("offset")[0].innerText),o=i.indexOf(e);if(o>=0){for(var s=o+a;s<0;)s+=i.length;return s%i.length}}return-1},this.valueToChar=function(e,t){var n=void 0;if(this.opts.$convertToUpcase.prop("checked")&&this.state.$alphabets.length>0)n=this.state.$alphabets[0];else for(var r=this.state.$alphabets.length,i=0;!n&&i<r;++i)this.state.$alphabets[i].getElementsByClassName("alphabet")[0].value.indexOf(t)>=0&&(n=this.state.$alphabets[i]);if(n){var a=n.getElementsByClassName("alphabet")[0].value,o=parseInt(n.getElementsByClassName("offset")[0].innerText);if(a.length){for(e-=o;e<0;)e+=a.length;return e%=a.length,a.substr(e,1)}}return t},this.normalizeKey=function(){var e=[],t=this.state.$key.val(),n=t.length,r=this.state.$keyAlphabets;r||(r=this.state.$alphabets);for(var i=0;i<n;++i){var a=this.charToValue(t[i],r);(a>=0||!this.opts.$skipNonLetterKeys.prop("checked"))&&e.push(a)}return e},this.process=function(e,t){return t?this.algo.encrypt(this.state.$alphabets,e):this.algo.decrypt(this.state.$alphabets,e)}}function n(e){function t(){jQuery("#alphabet-details").modal("hide"),g=null,y=null,m=null}function n(){jQuery("#alphabet-length").text(""+y.val().length)}function i(){y.val(l(jQuery("#compressed-alphabet").val())),n(),r()}function a(e){return function(t){var n=jQuery("#compressed-alphabet");n.val(n.val()+e),i(),t.preventDefault()}}function s(e){if(e.length<3)return e;for(var t="",n=0;n<e.length;)if("-"!==e[n]){var r=e[n].charCodeAt(0),i=n+1;if(i<e.length)if(r===e[i].charCodeAt(0)-1)for(;i<e.length&&r===e[i].charCodeAt(0)-1;)++i,++r;else if(r===e[i].charCodeAt(0)+1)for(;i<e.length&&r===e[i].charCodeAt(0)+1;)++i,--r;if(i-n>=3)t+=e[n]+"-"+e[i-1];else for(var a=n;a<i;++a)t+=e[a];n=i}else t+="---",++n;return t}function l(e){for(var t="",n=0;n<e.length;)if(n+2<e.length&&"-"===e[n+1]){if(e[n].charCodeAt(0)<e[n+2].charCodeAt(0))for(var r=e[n].charCodeAt(0);r<=e[n+2].charCodeAt(0);++r)t+=String.fromCharCode(r);else for(var i=e[n].charCodeAt(0);i>=e[n+2].charCodeAt(0);--i)t+=String.fromCharCode(i);n+=3}else t+=e[n],++n;return t}function h(e){g=e,y=jQuery(".alphabet",e),m=jQuery(".offset",e),jQuery("#compressed-alphabet").val(s(y.val())),jQuery("#keyword-for-alphabet").val(""),jQuery("#offset-for-alphabet").val(m.text()),n(),jQuery("#alphabet-details").modal("show")}function c(e){return function(){var t=jQuery(this),n=t.children("div").first(),i=n.children("input").first();e.push(t.get()[0]),i.on("keyup",r),n.children("span").first().children("button").first().on("click",function(e){h(t),e.preventDefault()})}}function u(t,n,i){var a=jQuery('<div class="form-group"><div class="input-group"><input type="text" class="form-control alphabet"><span class="input-group-btn"><button class="btn btn-default">…</button></span></div><span class="offset">'+i+'</span><div class="alert alert-danger alert-hidden"></div></div>');n.append(a);var o=jQuery("input",a);o.val(t),o.on("keyup",r),jQuery("button",a).on("click",function(e){h(a),e.preventDefault()}),e.$alphabets.push(a.get()[0]),r()}function f(e,t){if(e)for(var n=function(e){for(var t={},n=e.firstChild;n;n=n.nextSibling)for(var r=n.firstChild.firstChild,i=r.value,a=0;a<i.length;++a)t[i[a]]=t[i[a]]?t[i[a]]+1:1;return t}(e),r=e.firstChild;r;r=r.nextSibling){var i=r.firstChild.firstChild,a=i.value,o=r.firstChild.nextSibling.nextSibling,s="";if(0===a.length)s="Alphabet ist leer";else if(t){for(var l="",h=0,c={},u=0;u<a.length;++u)n[a[u]]>1&&(c[a[u]]||(h&&(l+=", "),l+=a[u],c[a[u]]=!0),++h);l.length&&(s=h>1?"Buchstaben $1 werden mehrfach verwendet":"Buchstabe $1 wird mehrfach verwendet",s=s.replace("$1",l))}if(s!==o.innerHTML){for(;o.firstChild;)o.removeChild(o.firstChild);o.appendChild(document.createTextNode(s)),s.length?o.classList.remove("alert-hidden"):o.classList.add("alert-hidden")}}}var p=jQuery("#alphabets"),d=jQuery("#key-alphabets"),b=jQuery("#keyword-for-alphabet");jQuery("#compressed-alphabet").on("keyup",function(){b.val(""),i()}),b.on("keyup",function(){var e=void 0,t="",n=y.val().split("").sort(),r=b.val();for(e=0;e<r.length;++e){var a=n.indexOf(r[e]);a>=0&&(t+=n[a],n.splice(a,1))}for(e=0;e<n.length;++e)t+=n[e];jQuery("#compressed-alphabet").val(s(t)),i()});var v=jQuery("#offset-for-alphabet");v.on("keyup",function(){var e=v.val();e.match(/^[+-]?[0-9]+$/)&&(m.text(e),r())}),jQuery("#alphabet-detail-buttons").children().each(function(){var e=jQuery(this),t=e.prop("id");t&&"add-"===t.substring(0,4)&&e.on("click",a(t.substring(4)))}),jQuery("#reverse-alphabet").on("click",function(e){for(var t="",n=y.val().length-1;n>=0;--n)t+=y.val()[n];jQuery("#compressed-alphabet").val(s(t)),i(),e.preventDefault()}),jQuery("#permute-alphabet").on("click",function(e){for(var t=y.val().split(""),n=t.length-1;n>0;--n){var r=Math.floor(Math.random()*n),a=t[r];t[r]=t[n],t[n]=a}jQuery("#compressed-alphabet").val(s(t.join(""))),i(),e.preventDefault()}),jQuery("#shift-alphabet-left").on("click",function(e){var t=y.val(),n=t.substr(1)+t.substr(0,1);jQuery("#compressed-alphabet").val(s(n)),i(),e.preventDefault()}),jQuery("#shift-alphabet-right").on("click",function(e){var t=y.val(),n=t.substr(t.length-1)+t.substr(0,t.length-1);jQuery("#compressed-alphabet").val(s(n)),i(),e.preventDefault()}),jQuery("#clone-alphabet-to-other-case").on("click",function(e){e.preventDefault();for(var n="",i=y.val(),a=0;a<i.length;++a)i[a]===i[a].toUpperCase()?n+=i[a].toLowerCase():n+=i[a].toUpperCase();u(n,jQuery(g.parent()),parseInt(m.text())),t(),r()}),jQuery("#delete-alphabet").on("click",function(n){e.$alphabets.splice(e.$alphabets.indexOf(y.get()[0]),1),g.remove(),t(),r(),n.preventDefault()});var g=void 0,y=void 0,m=void 0;jQuery(".form-group",p).each(c(e.$alphabets)),d.length&&(e.$keyAlphabets=[],jQuery(".form-group",d).each(c(e.$keyAlphabets))),jQuery("#add-alphabet").on("click",function(e){u("",p),e.preventDefault()});var C=jQuery("#add-key-alphabet");C&&C.on("click",function(e){u("",d),e.preventDefault()}),o=function(){f(p.get()[0],!0),f(d.get()[0],!1)}}function r(){o();var e=s.encrypting?s.$plain:s.$cipher;(s.encrypting?s.$cipher:s.$plain).val(h.process(e.val(),s.encrypting))}var i=new e,a={forEach:function(e,t){for(var n in e)e.hasOwnProperty(n)&&t(e[n],n)}},o=void 0,s=new function(){this.encrypting=!0,this.$plain=jQuery("#plain"),this.$cipher=jQuery("#cipher"),this.$key=jQuery("#key"),this.$direction=jQuery("#direction"),this.$alphabets=[],this.$keyAlphabets=void 0,this.setEncrypting=function(){this.encrypting||(this.$direction.removeClass("flip"),this.$direction.addClass("flop"),this.encrypting=!0)},this.setDecrypting=function(){this.encrypting&&(this.$direction.removeClass("flop"),this.$direction.addClass("flip"),this.encrypting=!1)},this.$direction.on("click",function(e){s.encrypting?s.setDecrypting():s.setEncrypting(),e.preventDefault()}),this.$plain.on("keyup",function(){s.setEncrypting(),r()}),this.$cipher.on("keyup",function(){s.setDecrypting(),r()}),this.$key.on("keyup",r)},l=new function(){this.$deleteWhitespace=jQuery("#deleteWhitespace"),this.$groupBy5s=jQuery("#groupBy5s"),this.$deleteNonLetters=jQuery("#deleteNonLetters"),this.$convertToUpcase=jQuery("#convertToUpcase"),this.$skipNonLetterKeys=jQuery("#skipNonLetterKeys"),a.forEach(this,function(e){e.on("change",r)})},h=new t(i,s,l);this.evokeUpdate=function(){r()},function(){n(s);var e=jQuery("#page");e&&e.append(jQuery("#alphabet-details"))}(),r()});