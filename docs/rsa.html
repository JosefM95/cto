<!doctype html>
<html lang="de"l>
<head>
<meta charset="utf-8">
<title>RSA Implementierung in JavaScript</title><link rel="stylesheet" type="text/css" href="slides/slides.css"></head>
<body>
<h1>RSA Implementierung in JavaScript</h1>
<div class="slides">
<div><div>
<h1>RSA Implementierung in JavaScript</h1>
</div>
</div>
<div><div>
<code>

<span class="add">@def(<span class="name">file: rsa.js)</span></span><br/>
<span class="in1"></span>
<span class="fn">jQuery</span>((<span class="fn">$</span>) =&gt; {<br/>
<span class="in2"></span>
<span class="expand">@expand(<span class="name">globals)</span></span>;<br/>
<span class="in2"></span>
<span class="expand">@expand(<span class="name">setup rsa)</span></span>;<br/>
<span class="in1"></span>
});<br/>

<span class="end">@end(<span class="name">file: rsa.js)</span></span><br/>
</code>
</div>
<ul><li>
 Der gesamte Code wird abgearbeitet, nachdem die Webseite vollständig
  geladen wurde</li><li>
 Durch das Scoping in einer eigenen Funktion wird der globale
  Namensraum nicht verschmutzt</li><li>
 Dieses Projekt verwendet <code>jQuery</code></li></ul></div>
</div>
<h1>Refresh</h1>
<div class="slides">
<div><div>
<h1>Refresh</h1>
</div>
<ul><li>
 Neben den wenigen Aktionen findet die Hauptarbeit während des Refreshs
  statt</li></ul></div>
<div><div>
<code>

<span class="add">@def(<span class="name">setup rsa)</span></span><br/>
<span class="in1"></span>
<span class="type">const</span> <span class="fn">refresh</span> = () =&gt; {<br/>
<span class="in2"></span>
<span class="expand">@expand(<span class="name">refresh)</span></span>;<br/>
<span class="in1"></span>
};<br/>
<span class="in1"></span>
<span class="fn">refresh</span>();<br/>

<span class="end">@end(<span class="name">setup rsa)</span></span><br/>
</code>
</div>
<ul><li>
 Während des Refreshs werden alle zu berechnenden Felder neu berechnet</li></ul></div>
<div><div>
<code>

<span class="add">@def(<span class="name">globals)</span></span><br/>
<span class="in1"></span>
<span class="type">const</span> <span class="var">$prime1</span> = <span class="fn">$</span>(<span class="str">'#prime-1'</span>);<br/>
<span class="in1"></span>
<span class="type">const</span> <span class="var">$prime2</span> = <span class="fn">$</span>(<span class="str">'#prime-2'</span>);<br/>
<span class="in1"></span>
<span class="type">const</span> <span class="var">$errPNotPrime</span> =<br/>
<span class="in2"></span>
<span class="fn">$</span>(<span class="str">'#err-p-not-prime'</span>);<br/>
<span class="in1"></span>
<span class="type">const</span> <span class="var">$errQNotPrime</span> =<br/>
<span class="in2"></span>
<span class="fn">$</span>(<span class="str">'#err-q-not-prime'</span>);<br/>
<span class="in1"></span>
<span class="type">const</span> <span class="var">$errPEqualQ</span> =<br/>
<span class="in2"></span>
<span class="fn">$</span>(<span class="str">'#err-p-equal-q'</span>);<br/>

<span class="end">@end(<span class="name">globals)</span></span><br/>
</code>
</div>
<ul><li>
 In zwei Textfeldern werden die Primzahlen eingegeben</li><li>
 Zusätzlich gibt es Panels mit Fehlermeldungen</li><li>
 Diese sind aber versteckt, wenn der Fehler nicht aufgetreten ist</li><li>
 Die Objekte werden in globalen Variablen abgelegt, um sie nicht jedes
  Mal suchen zu müssen</li></ul></div>
<div><div>
<code>

<span class="add">@def(<span class="name">refresh)</span></span><br/>
<span class="in1"></span>
<span class="type">const</span> <span class="var">prime1</span> = <span class="fn">bigInt</span>(<span class="var">$prime1</span>.<span class="fn">val</span>());<br/>
<span class="in1"></span>
<span class="var">$errPNotPrime</span>.<span class="fn">toggleClass</span>(<br/>
<span class="in2"></span>
<span class="str">'hidden'</span>, <span class="var">prime1</span>.<span class="fn">isProbablePrime</span>()<br/>
<span class="in1"></span>
);<br/>
<span class="in1"></span>
<span class="type">const</span> <span class="var">prime2</span> = <span class="fn">bigInt</span>(<span class="var">$prime2</span>.<span class="fn">val</span>());<br/>
<span class="in1"></span>
<span class="var">$errQNotPrime</span>.<span class="fn">toggleClass</span>(<br/>
<span class="in2"></span>
<span class="str">'hidden'</span>, <span class="var">prime2</span>.<span class="fn">isProbablePrime</span>()<br/>
<span class="in1"></span>
);<br/>
<span class="in1"></span>
<span class="var">$errPEqualQ</span>.<span class="fn">toggleClass</span>(<br/>
<span class="in2"></span>
<span class="str">'hidden'</span>, ! <span class="var">prime1</span>.<span class="fn">equals</span>(<span class="var">prime2</span>)<br/>
<span class="in1"></span>
);<br/>

<span class="end">@end(<span class="name">refresh)</span></span><br/>
</code>
</div>
<ul><li>
 Die beiden Primzahlen werden aus dem DOM-Modell gelesen</li><li>
 Und in große Zahlen konvertiert</li><li>
 Wenn sie vermutlich keine Primzahl oder gleich sind, wird die
  passende Fehlermeldung angezeigt</li><li>
 Und andernfalls ausgeblendet</li></ul></div>
<div><div>
<code>

<span class="add">@add(<span class="name">globals)</span></span><br/>
<span class="in1"></span>
<span class="type">const</span> <span class="var">$public_key</span> =<br/>
<span class="in2"></span>
<span class="fn">$</span>(<span class="str">'#public-key'</span>);<br/>
<span class="in1"></span>
<span class="type">const</span> <span class="var">$public_key_length</span> =<br/>
<span class="in2"></span>
<span class="fn">$</span>(<span class="str">'#public-key-length'</span>);<br/>

<span class="end">@end(<span class="name">globals)</span></span><br/>
</code>
</div>
<ul><li>
 In zwei Elementen wird der öffentliche Schlüssel und dessen Länge
  abgelegt</li></ul></div>
<div><div>
<code>

<span class="add">@add(<span class="name">refresh)</span></span><br/>
<span class="in1"></span>
<span class="type">const</span> <span class="var">public_key</span> =<br/>
<span class="in2"></span>
<span class="var">prime1</span>.<span class="fn">multiply</span>(<span class="var">prime2</span>);<br/>
<span class="in1"></span>
<span class="var">$public_key</span>.<span class="fn">text</span>(<br/>
<span class="in2"></span>
<span class="var">public_key</span>.<span class="fn">toString</span>()<br/>
<span class="in1"></span>
);<br/>
<span class="in1"></span>
<span class="var">$public_key_length</span>.<span class="fn">text</span>(<br/>
<span class="in2"></span>
<span class="var">public_key</span>.<span class="fn">bitLength</span>()<br/>
<span class="in1"></span>
);<br/>

<span class="end">@end(<span class="name">refresh)</span></span><br/>
</code>
</div>
<ul><li>
 Der öffentliche Schlüssel ist das Produkt der beiden Primzahlen</li><li>
 Die Länge des Schlüssels kann die Integer-Bibliothek direkt ermitteln</li></ul></div>
<div><div>
<code>

<span class="add">@add(<span class="name">globals)</span></span><br/>
<span class="in1"></span>
<span class="type">const</span> <span class="var">$phi</span> = <span class="fn">$</span>(<span class="str">'#phi'</span>);<br/>

<span class="end">@end(<span class="name">globals)</span></span><br/>
</code>
</div>
<ul><li>
 Auch das Ergebnis der φ-Funktion wird auf der Webseite angezeigt</li></ul></div>
<div><div>
<code>

<span class="add">@add(<span class="name">refresh)</span></span><br/>
<span class="in1"></span>
<span class="type">const</span> <span class="var">one</span> = <span class="fn">bigInt</span>.<span class="var">one</span>;<br/>
<span class="in1"></span>
<span class="type">const</span> <span class="var">phi</span> = <span class="var">prime1</span>.<span class="fn">subtract</span>(<span class="var">one</span>).<br/>
<span class="in2"></span>
<span class="fn">multiply</span>(<span class="var">prime2</span>.<span class="fn">subtract</span>(<span class="var">one</span>));<br/>
<span class="in1"></span>
<span class="var">$phi</span>.<span class="fn">text</span>(<span class="var">phi</span>.<span class="fn">toString</span>());<br/>

<span class="end">@end(<span class="name">refresh)</span></span><br/>
</code>
</div>
<ul><li>
 Da davon ausgegangen wird, dass die beiden Primzahlen verschieden
  sind, ist das Produkt deren Vorgänger der Wert der φ-Funktion
  des öffentlichen Schlüssels</li></ul></div>
<div><div>
<code>

<span class="add">@add(<span class="name">globals)</span></span><br/>
<span class="in1"></span>
<span class="type">const</span> <span class="fn">gcd</span> = (<span class="var">a</span>, <span class="var">b</span>) =&gt; {<br/>
<span class="in2"></span>
<span class="expand">@expand(<span class="name">gcd)</span></span>;<br/>
<span class="in1"></span>
};<br/>

<span class="end">@end(<span class="name">globals)</span></span><br/>
</code>
</div>
<ul><li>
 Das inverse Element kann mit dem Erweiterten Euklidischen Algorithmus
  berechnet werden</li><li>
 Dieser wird weiter unten implementiert</li></ul></div>
<div><div>
<code>

<span class="add">@add(<span class="name">globals)</span></span><br/>
<span class="in1"></span>
<span class="type">const</span> <span class="var">$e</span> = <span class="fn">$</span>(<span class="str">'#base'</span>);<br/>
<span class="in1"></span>
<span class="type">const</span> <span class="var">$gcd</span> = <span class="fn">$</span>(<span class="str">'#gcd'</span>);<br/>

<span class="end">@end(<span class="name">globals)</span></span><br/>
</code>
</div>
<ul><li>
 Der Wert <code><span class="var">e</span></code> wird wie die Primzahlen aus einem Textfeld ausgelesen</li><li>
 Der kleinste gemeinsame Teiler wird zur Kontrolle auch angezeigt</li></ul></div>
<div><div>
<code>

<span class="add">@add(<span class="name">refresh)</span></span><br/>
<span class="in1"></span>
<span class="type">const</span> <span class="var">e</span> = <span class="fn">bigInt</span>(<span class="var">$e</span>.<span class="fn">val</span>());<br/>
<span class="in1"></span>
<span class="type">const</span> <span class="var">gg</span> = <span class="fn">gcd</span>(<span class="var">phi</span>, <span class="var">e</span>);<br/>
<span class="in1"></span>
<span class="var">$errGcdNot1</span>.<span class="fn">toggleClass</span>(<br/>
<span class="in2"></span>
<span class="str">'hidden'</span>, <span class="var">gg</span>.<span class="var">a</span>.<span class="fn">equals</span>(<span class="num">1</span>)<br/>
<span class="in1"></span>
);<br/>
<span class="in1"></span>
<span class="var">$gcd</span>.<span class="fn">text</span>(<span class="var">gg</span>.<span class="var">a</span>.<span class="fn">toString</span>());<br/>

<span class="end">@end(<span class="name">refresh)</span></span><br/>
</code>
</div>
<ul><li>
 Wenn <code><span class="var">e</span></code> mit dem Wert der φ-Funktion nicht teilerfremd sind, wird
  eine entsprechende Fehlermeldung angezeigt</li></ul></div>
<div><div>
<code>

<span class="add">@add(<span class="name">globals)</span></span><br/>
<span class="in1"></span>
<span class="type">const</span> <span class="var">$private_key</span> = <span class="fn">$</span>(<span class="str">'#private-key'</span>);<br/>

<span class="end">@end(<span class="name">globals)</span></span><br/>
</code>
</div>
<ul><li>
 Der private Schlüssel wird auch auf der Webseite ausgegeben</li></ul></div>
<div><div>
<code>

<span class="add">@add(<span class="name">refresh)</span></span><br/>
<span class="in1"></span>
<span class="type">let</span> <span class="var">private_key</span> = <span class="var">gg</span>.<span class="var">v</span>;<br/>
<span class="in1"></span>
<span class="keyword">if</span> (<span class="var">private_key</span>.<span class="fn">lesser</span>(<span class="num">0</span>)) {<br/>
<span class="in2"></span>
<span class="var">private_key</span> = <span class="var">private_key</span>.<span class="fn">add</span>(<span class="var">phi</span>);<br/>
<span class="in1"></span>
}<br/>
<span class="in1"></span>
<span class="var">$private_key</span>.<span class="fn">text</span>(<span class="var">private_key</span>.<span class="fn">toString</span>());<br/>

<span class="end">@end(<span class="name">refresh)</span></span><br/>
</code>
</div>
<ul><li>
 Der private Schlüssel ist das multiplikative Inverse Modulo φ</li></ul></div>
<div><div>
<code>

<span class="add">@add(<span class="name">globals)</span></span><br/>
<span class="in1"></span>
<span class="type">let</span> <span class="var">encrypt</span> = <span class="keyword">true</span>;<br/>

<span class="end">@end(<span class="name">globals)</span></span><br/>
</code>
</div>
<ul><li>
 Der Algorithmus kann sowohl Ver- als auch Entschlüsseln</li><li>
 Diese Variable bestimmt, in welche Richtung der Algorithmus läuft</li></ul></div>
<div><div>
<code>

<span class="add">@add(<span class="name">refresh)</span></span><br/>
<span class="in1"></span>
<span class="keyword">if</span> (<span class="var">encrypt</span>) {<br/>
<span class="in2"></span>
<span class="expand">@expand(<span class="name">encrypt)</span></span>;<br/>
<span class="in1"></span>
} <span class="keyword">else</span> {<br/>
<span class="in2"></span>
<span class="expand">@expand(<span class="name">decrypt)</span></span>;<br/>
<span class="in1"></span>
}<br/>

<span class="end">@end(<span class="name">refresh)</span></span><br/>
</code>
</div>
</div>
<div><div>
<code>

<span class="add">@add(<span class="name">refresh)</span></span><br/>
<span class="in1"></span>
<span class="var">timer</span> = <span class="keyword">null</span>;<br/>

<span class="end">@end(<span class="name">refresh)</span></span><br/>
</code>
</div>
</div>
<div><div>
<code>

<span class="add">@def(<span class="name">encrypt)</span></span><br/>
<span class="in1"></span>
<span class="type">const</span> <span class="var">source</span> =<br/>
<span class="in2"></span>
<span class="fn">bigInt</span>(<span class="var">$private_message</span>.<span class="fn">val</span>());<br/>
<span class="in1"></span>
<span class="var">$errPublicMsgTooBig</span>.<span class="fn">toggleClass</span>(<br/>
<span class="in2"></span>
<span class="str">'hidden'</span>, <span class="var">source</span>.<span class="fn">lesser</span>(<span class="var">public_key</span>)<br/>
<span class="in1"></span>
);<br/>
<span class="in1"></span>
<span class="var">$errPrivateMsgTooBig</span>.<span class="fn">toggleClass</span>(<br/>
<span class="in2"></span>
<span class="str">'hidden'</span>, <span class="keyword">true</span><br/>
<span class="in1"></span>
);<br/>
<span class="in1"></span>
<span class="type">const</span> <span class="var">encrypted</span> = <span class="var">source</span>.<span class="fn">modPow</span>(<br/>
<span class="in2"></span>
<span class="var">e</span>, <span class="var">public_key</span><br/>
<span class="in1"></span>
);<br/>
<span class="in1"></span>
<span class="var">$public_message</span>.<span class="fn">val</span>(<br/>
<span class="in2"></span>
<span class="var">encrypted</span>.<span class="fn">toString</span>()<br/>
<span class="in1"></span>
);<br/>

<span class="end">@end(<span class="name">encrypt)</span></span><br/>
</code>
</div>
</div>
<div><div>
<code>

<span class="add">@def(<span class="name">decrypt)</span></span><br/>
<span class="in1"></span>
<span class="type">const</span> <span class="var">source</span> =<br/>
<span class="in2"></span>
<span class="fn">bigInt</span>(<span class="var">$public_message</span>.<span class="fn">val</span>());<br/>
<span class="in1"></span>
<span class="var">$errPublicMsgTooBig</span>.<span class="fn">toggleClass</span>(<br/>
<span class="in2"></span>
<span class="str">'hidden'</span>, <span class="keyword">true</span><br/>
<span class="in1"></span>
);<br/>
<span class="in1"></span>
<span class="var">$errPrivateMsgTooBig</span>.<span class="fn">toggleClass</span>(<br/>
<span class="in2"></span>
<span class="str">'hidden'</span>, <span class="var">source</span>.<span class="fn">lesser</span>(<span class="var">public_key</span>)<br/>
<span class="in1"></span>
);<br/>
<span class="in1"></span>
<span class="keyword">const</span> <span class="var">decrypted</span> = <span class="var">source</span>.<span class="fn">modPow</span>(<br/>
<span class="in2"></span>
<span class="var">private_key</span>, <span class="var">public_key</span><br/>
<span class="in1"></span>
);<br/>
<span class="in1"></span>
<span class="var">$private_message</span>.<span class="fn">val</span>(<br/>
<span class="in2"></span>
<span class="var">decrypted</span>.<span class="fn">toString</span>()<br/>
<span class="in1"></span>
);<br/>

<span class="end">@end(<span class="name">decrypt)</span></span><br/>
</code>
</div>
</div>
</div>
<h1>Größter gemeinsamer Teiler</h1>
<div class="slides">
<div><div>
<h1>Größter gemeinsamer Teiler</h1>
</div>
</div>
<div><div>
<code>

<span class="add">@def(<span class="name">gcd)</span></span><br/>
<span class="in1"></span>
<span class="type">let</span> <span class="var">ca</span> = <span class="var">a</span>;<br/>
<span class="in1"></span>
<span class="type">let</span> <span class="var">cb</span> = <span class="var">b</span>;<br/>

<br/>
<span class="in1"></span>
<span class="type">let</span> <span class="var">u</span> = <span class="fn">bigInt</span>.<span class="var">one</span>;<br/>
<span class="in1"></span>
<span class="type">let</span> <span class="var">s</span> = <span class="fn">bigInt</span>.<span class="var">zero</span>;<br/>
<span class="in1"></span>
<span class="type">let</span> <span class="var">v</span> = <span class="var">s</span>;<br/>
<span class="in1"></span>
<span class="type">let</span> <span class="var">t</span> = <span class="var">u</span>;<br/>

<span class="end">@end(<span class="name">gcd)</span></span><br/>
</code>
</div>
</div>
<div><div>
<code>

<span class="add">@add(<span class="name">gcd)</span></span><br/>
<span class="in1"></span>
<span class="keyword">while</span> (! <span class="var">cb</span>.<span class="fn">isZero</span>()) {<br/>
<span class="in2"></span>
<span class="expand">@expand(<span class="name">gcd loop)</span></span>;<br/>
<span class="in1"></span>
}<br/>

<span class="end">@end(<span class="name">gcd)</span></span><br/>
</code>
</div>
</div>
<div><div>
<code>

<span class="add">@def(<span class="name">gcd loop)</span></span><br/>
<span class="in1"></span>
<span class="type">const</span> <span class="var">dd</span> = <span class="var">ca</span>.<span class="fn">divmod</span>(<span class="var">cb</span>);<br/>
<span class="in1"></span>
<span class="type">const</span> <span class="var">na</span> = <span class="var">cb</span>;<br/>

<br/>
<span class="in1"></span>
<span class="type">const</span> <span class="var">nb</span> = <span class="var">dd</span>.<span class="var">remainder</span>;<br/>
<span class="in1"></span>
<span class="type">const</span> <span class="var">nu</span> = <span class="var">s</span>;<br/>
<span class="in1"></span>
<span class="type">const</span> <span class="var">nv</span> = <span class="var">t</span>;<br/>
<span class="in1"></span>
<span class="type">const</span> <span class="var">ns</span> =<br/>
<span class="in2"></span>
<span class="var">u</span>.<span class="fn">subtract</span>(<span class="var">dd</span>.<span class="var">quotient</span>.<span class="fn">multiply</span>(<span class="var">s</span>));<br/>
<span class="in1"></span>
<span class="type">const</span> <span class="var">nt</span> =<br/>
<span class="in2"></span>
<span class="var">v</span>.<span class="fn">subtract</span>(<span class="var">dd</span>.<span class="var">quotient</span>.<span class="fn">multiply</span>(<span class="var">t</span>));<br/>

<span class="end">@end(<span class="name">gcd loop)</span></span><br/>
</code>
</div>
</div>
<div><div>
<code>

<span class="add">@add(<span class="name">gcd loop)</span></span><br/>
<span class="in1"></span>
<span class="var">ca</span> = <span class="var">na</span>;<br/>
<span class="in1"></span>
<span class="var">cb</span> = <span class="var">nb</span>;<br/>
<span class="in1"></span>
<span class="var">u</span> = <span class="var">nu</span>;<br/>
<span class="in1"></span>
<span class="var">v</span> = <span class="var">nv</span>;<br/>
<span class="in1"></span>
<span class="var">s</span> = <span class="var">ns</span>;<br/>
<span class="in1"></span>
<span class="var">t</span> = <span class="var">nt</span>;<br/>

<span class="end">@end(<span class="name">gcd loop)</span></span><br/>
</code>
</div>
</div>
<div><div>
<code>

<span class="add">@add(<span class="name">gcd)</span></span><br/>
<span class="in1"></span>
<span class="keyword">return</span> {<br/>
<span class="in2"></span>
<span class="str">a</span>: <span class="var">ca</span>, <span class="str">u</span>: <span class="var">u</span>, <span class="str">v</span>: <span class="var">v</span>,<br/>
<span class="in2"></span>
<span class="str">s</span>: <span class="var">s</span>, <span class="str">t</span>: <span class="var">t</span> <br/>
<span class="in1"></span>
};<br/>

<span class="end">@end(<span class="name">gcd)</span></span><br/>
</code>
</div>
</div>
</div>
<h1>Interaktion</h1>
<div class="slides">
<div><div>
<h1>Interaktion</h1>
</div>
</div>
<div><div>
<code>

<span class="add">@add(<span class="name">globals)</span></span><br/>
<span class="in1"></span>
<span class="type">const</span> <span class="var">$private_message</span> =<br/>
<span class="in2"></span>
<span class="fn">$</span>(<span class="str">'#private-message'</span>);<br/>
<span class="in1"></span>
<span class="type">const</span> <span class="var">$public_message</span> =<br/>
<span class="in2"></span>
<span class="fn">$</span>(<span class="str">'#public-message'</span>);<br/>
<span class="in1"></span>
<span class="type">const</span> <span class="var">$direction</span> =<br/>
<span class="in2"></span>
<span class="fn">$</span>(<span class="str">'#direction'</span>);<br/>
<span class="in1"></span>
<span class="type">const</span> <span class="var">$errGcdNot1</span> =<br/>
<span class="in2"></span>
<span class="fn">$</span>(<span class="str">'#err-gcd-not-1'</span>);<br/>
<span class="in1"></span>
<span class="type">const</span> <span class="var">$errPublicMsgTooBig</span> =<br/>
<span class="in2"></span>
<span class="fn">$</span>(<span class="str">'#err-public-msg-too-big'</span>);<br/>
<span class="in1"></span>
<span class="type">const</span> <span class="var">$errPrivateMsgTooBig</span> =<br/>
<span class="in2"></span>
<span class="fn">$</span>(<span class="str">'#err-private-msg-too-big'</span>);<br/>
<span class="in1"></span>
<span class="type">let</span> <span class="var">timer</span>;<br/>

<span class="end">@end(<span class="name">globals)</span></span><br/>
</code>
</div>
</div>
<div><div>
<code>

<span class="add">@add(<span class="name">setup rsa)</span></span><br/>
<span class="in1"></span>
<span class="type">const</span> <span class="fn">setEncrypt</span> = <span class="var">new_encrypt</span> =&gt; {<br/>
<span class="in2"></span>
<span class="keyword">if</span> (<span class="var">encrypt</span> === <span class="var">new_encrypt</span>) { <span class="keyword">return</span>; }<br/>
<span class="in2"></span>
<span class="var">encrypt</span> = <span class="var">new_encrypt</span>;<br/>
<span class="in2"></span>
<span class="keyword">if</span> (<span class="var">encrypt</span>) {<br/>
<span class="in3"></span>
<span class="var">$direction</span>.<span class="fn">removeClass</span>(<span class="str">'flip'</span>);<br/>
<span class="in3"></span>
<span class="var">$direction</span>.<span class="fn">addClass</span>(<span class="str">'flop'</span>);<br/>
<span class="in2"></span>
} else {<br/>
<span class="in3"></span>
<span class="var">$direction</span>.<span class="fn">removeClass</span>(<span class="str">'flop'</span>);<br/>
<span class="in3"></span>
<span class="var">$direction</span>.<span class="fn">addClass</span>(<span class="str">'flip'</span>);<br/>
<span class="in2"></span>
}<br/>
<span class="in1"></span>
};<br/>

<span class="end">@end(<span class="name">setup rsa)</span></span><br/>
</code>
</div>
</div>
<div><div>
<code>

<span class="add">@add(<span class="name">setup rsa)</span></span><br/>
<span class="in1"></span>
<span class="type">const</span> <span class="fn">queueRefresh</span> = <span class="var">event</span> =&gt; {<br/>
<span class="in2"></span>
<span class="var">event</span>.<span class="fn">preventDefault</span>();<br/>
<span class="in2"></span>
<span class="keyword">if</span> (! <span class="var">timer</span>) {<br/>
<span class="in3"></span>
<span class="fn">refresh</span>();<br/>
<span class="in2"></span>
} <span class="keyword">else</span> {<br/>
<span class="in3"></span>
<span class="fn">clearTimeout</span>(<span class="var">timer</span>);<br/>
<span class="in3"></span>
<span class="expand">@expand(<span class="name">set fields to pending)</span></span>;<br/>
<span class="in2"></span>
}<br/>
<span class="in2"></span>
<span class="var">timer</span> = <span class="fn">setTimeout</span>(<span class="var">refresh</span>, <span class="var">500</span>);<br/>
<span class="in1"></span>
}<br/>

<span class="end">@end(<span class="name">setup rsa)</span></span><br/>
</code>
</div>
</div>
<div><div>
<code>

<span class="add">@def(<span class="name">set fields to pending)</span></span><br/>
<span class="in1"></span>
<span class="var">$public_key_length</span>.<span class="fn">text</span>(<span class="str">'...'</span>);<br/>
<span class="in1"></span>
<span class="var">$public_key</span>.<span class="fn">text</span>(<span class="str">'...'</span>);<br/>
<span class="in1"></span>
<span class="var">$phi</span>.<span class="fn">text</span>(<span class="str">'...'</span>);<br/>
<span class="in1"></span>
<span class="var">$gcd</span>.<span class="fn">text</span>(<span class="str">'...'</span>);<br/>
<span class="in1"></span>
<span class="var">$private_key</span>.<span class="fn">text</span>(<span class="str">'...'</span>);<br/>

<br/>
<span class="in1"></span>
<span class="keyword">if</span> (<span class="var">encrypt</span>) {<br/>
<span class="in2"></span>
<span class="var">$public_message</span>.<span class="fn">val</span>(<span class="str">'...'</span>);<br/>
<span class="in1"></span>
} <span class="keyword">else</span> {<br/>
<span class="in2"></span>
<span class="var">$private_message</span>.<span class="fn">val</span>(<span class="str">'...'</span>);<br/>
<span class="in1"></span>
}<br/>

<span class="end">@end(<span class="name">set fields to pending)</span></span><br/>
</code>
</div>
</div>
<div><div>
<code>

<span class="add">@add(<span class="name">setup rsa)</span></span><br/>
<span class="in1"></span>
<span class="var">$prime1</span>.<span class="fn">on</span>(<span class="str">'input'</span>, <span class="fn">queueRefresh</span>);<br/>
<span class="in1"></span>
<span class="var">$prime2</span>.<span class="fn">on</span>(<span class="str">'input'</span>, <span class="fn">queueRefresh</span>);<br/>
<span class="in1"></span>
<span class="var">$e</span>.<span class="fn">on</span>(<span class="str">'input'</span>, <span class="fn">queueRefresh</span>);<br/>
<span class="in1"></span>
<span class="var">$private_message</span>.<span class="fn">on</span>(<span class="str">'input'</span>, <span class="var">event</span> =&gt; {<br/>
<span class="in2"></span>
<span class="fn">setEncrypt</span>(<span class="keyword">true</span>);<br/>
<span class="in2"></span>
<span class="fn">queueRefresh</span>(<span class="var">event</span>);<br/>
<span class="in1"></span>
});<br/>
<span class="in1"></span>
<span class="var">$public_message</span>.<span class="fn">on</span>(<span class="str">'input'</span>, <span class="var">event</span> =&gt; {<br/>
<span class="in2"></span>
<span class="fn">setEncrypt</span>(<span class="keyword">false</span>);<br/>
<span class="in2"></span>
<span class="fn">queueRefresh</span>(<span class="var">event</span>);<br/>
<span class="in1"></span>
});<br/>

<span class="end">@end(<span class="name">setup rsa)</span></span><br/>
</code>
</div>
</div>
<div><div>
<code>

<span class="add">@add(<span class="name">refresh)</span></span><br/>
<span class="in1"></span>
<span class="var">timer</span> = <span class="keyword">null</span>;<br/>

<span class="end">@end(<span class="name">refresh)</span></span><br/>
</code>
</div>
