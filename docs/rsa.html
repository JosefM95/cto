<!doctype html>
<html lang="de"l>
<head>
<meta charset="utf-8">
<title>RSA-Implementierung in JavaScript</title><link rel="stylesheet" type="text/css" href="slides/slides.css"></head>
<body>
<h1>RSA-Implementierung in JavaScript</h1>
<div class="slides">
<div><div>
<h1>RSA-Implementierung in JavaScript</h1>
</div>
</div>
<div><div>
<code>

<span class="add">@def(<span class="name">file: rsa.js)</span></span><br/>
<span class="in1"></span>
<span class="fn">jQuery</span>((<span class="fn">$</span>) =&gt; {<br/>
<span class="in2"></span>
<span class="expand">@expand(<span class="name">globals)</span></span>;<br/>
<span class="in2"></span>
<span class="expand">@expand(<span class="name">setup rsa)</span></span>;<br/>
<span class="in1"></span>
});<br/>

<span class="end">@end(<span class="name">file: rsa.js)</span></span><br/>
</code>
</div>
<ul><li>
 Der gesamte Code wird abgearbeitet, nachdem die Webseite vollständig
  geladen wurde</li><li>
 Durch das Scoping in einer eigenen Funktion wird der globale
  Namensraum nicht verschmutzt</li><li>
 Dieses Projekt verwendet <code>jQuery</code></li></ul></div>
</div>
<h1>Refresh</h1>
<div class="slides">
<div><div>
<h1>Refresh</h1>
</div>
<ul><li>
 Neben den wenigen Aktionen findet die Hauptarbeit während des Refreshs
  statt</li></ul></div>
<div><div>
<code>

<span class="add">@def(<span class="name">setup rsa)</span></span><br/>
<span class="in1"></span>
<span class="keyword">const</span> <span class="fn">refresh</span> = () =&gt; {<br/>
<span class="in2"></span>
<span class="expand">@expand(<span class="name">refresh)</span></span>;<br/>
<span class="in1"></span>
};<br/>
<span class="in1"></span>
<span class="fn">refresh</span>();<br/>

<span class="end">@end(<span class="name">setup rsa)</span></span><br/>
</code>
</div>
<ul><li>
 Während des Refreshs werden alle zu berechnenden Felder neu berechnet</li></ul></div>
<div><div>
<code>

<span class="add">@def(<span class="name">globals)</span></span><br/>
<span class="in1"></span>
<span class="keyword">const</span> <span class="var">$prime1</span> = <span class="fn">$</span>(<span class="str">'#prime-1'</span>);<br/>
<span class="in1"></span>
<span class="keyword">const</span> <span class="var">$prime2</span> = <span class="fn">$</span>(<span class="str">'#prime-2'</span>);<br/>
<span class="in1"></span>
<span class="keyword">const</span> <span class="var">$errPNotPrime</span> =<br/>
<span class="in2"></span>
<span class="fn">$</span>(<span class="str">'#err-p-not-prime'</span>);<br/>
<span class="in1"></span>
<span class="keyword">const</span> <span class="var">$errQNotPrime</span> =<br/>
<span class="in2"></span>
<span class="fn">$</span>(<span class="str">'#err-q-not-prime'</span>);<br/>
<span class="in1"></span>
<span class="keyword">const</span> <span class="var">$errPEqualQ</span> =<br/>
<span class="in2"></span>
<span class="fn">$</span>(<span class="str">'#err-p-equal-q'</span>);<br/>

<span class="end">@end(<span class="name">globals)</span></span><br/>
</code>
</div>
<ul><li>
 In zwei Textfeldern werden die Primzahlen eingegeben</li><li>
 Zusätzlich gibt es Panels mit Fehlermeldungen</li><li>
 Diese sind aber versteckt, wenn der Fehler nicht aufgetreten ist</li><li>
 Die Objekte werden in globalen Variablen abgelegt, um sie nicht jedes
  Mal suchen zu müssen</li></ul></div>
<div><div>
<code>

<span class="add">@def(<span class="name">refresh)</span></span><br/>
<span class="in1"></span>
<span class="keyword">const</span> <span class="var">prime1</span> = <span class="fn">bigInt</span>(<span class="var">$prime1</span>.<span class="fn">val</span>());<br/>
<span class="in1"></span>
<span class="var">$errPNotPrime</span>.<span class="fn">toggleClass</span>(<br/>
<span class="in2"></span>
<span class="str">'hidden'</span>, <span class="var">prime1</span>.<span class="fn">isProbablePrime</span>()<br/>
<span class="in1"></span>
);<br/>
<span class="in1"></span>
<span class="keyword">const</span> <span class="var">prime2</span> = <span class="fn">bigInt</span>(<span class="var">$prime2</span>.<span class="fn">val</span>());<br/>
<span class="in1"></span>
<span class="var">$errQNotPrime</span>.<span class="fn">toggleClass</span>(<br/>
<span class="in2"></span>
<span class="str">'hidden'</span>, <span class="var">prime2</span>.<span class="fn">isProbablePrime</span>()<br/>
<span class="in1"></span>
);<br/>
<span class="in1"></span>
<span class="var">$errPEqualQ</span>.<span class="fn">toggleClass</span>(<br/>
<span class="in2"></span>
<span class="str">'hidden'</span>, ! <span class="var">prime1</span>.<span class="fn">equals</span>(<span class="var">prime2</span>)<br/>
<span class="in1"></span>
);<br/>

<span class="end">@end(<span class="name">refresh)</span></span><br/>
</code>
</div>
<ul><li>
 Die beiden Primzahlen werden aus dem DOM-Modell gelesen</li><li>
 Und in große Zahlen konvertiert</li><li>
 Wenn sie vermutlich keine Primzahl oder gleich sind, wird die
  passende Fehlermeldung angezeigt</li><li>
 Und andernfalls ausgeblendet</li></ul></div>
<div><div>
<code>

<span class="add">@add(<span class="name">globals)</span></span><br/>
<span class="in1"></span>
<span class="keyword">const</span> <span class="var">$public_key</span> =<br/>
<span class="in2"></span>
<span class="fn">$</span>(<span class="str">'#public-key'</span>);<br/>
<span class="in1"></span>
<span class="keyword">const</span> <span class="var">$public_key_length</span> =<br/>
<span class="in2"></span>
<span class="fn">$</span>(<span class="str">'#public-key-length'</span>);<br/>

<span class="end">@end(<span class="name">globals)</span></span><br/>
</code>
</div>
<ul><li>
 In zwei Elementen wird der öffentliche Schlüssel und dessen Länge
  abgelegt</li></ul></div>
<div><div>
<code>

<span class="add">@add(<span class="name">refresh)</span></span><br/>
<span class="in1"></span>
<span class="keyword">const</span> <span class="var">public_key</span> =<br/>
<span class="in2"></span>
<span class="var">prime1</span>.<span class="fn">multiply</span>(<span class="var">prime2</span>);<br/>
<span class="in1"></span>
<span class="var">$public_key</span>.<span class="fn">text</span>(<br/>
<span class="in2"></span>
<span class="var">public_key</span>.<span class="fn">toString</span>()<br/>
<span class="in1"></span>
);<br/>
<span class="in1"></span>
<span class="var">$public_key_length</span>.<span class="fn">text</span>(<br/>
<span class="in2"></span>
<span class="var">public_key</span>.<span class="fn">bitLength</span>()<br/>
<span class="in1"></span>
);<br/>

<span class="end">@end(<span class="name">refresh)</span></span><br/>
</code>
</div>
<ul><li>
 Der öffentliche Schlüssel ist das Produkt der beiden Primzahlen</li><li>
 Die Länge des Schlüssels kann die Integer-Bibliothek direkt ermitteln</li></ul></div>
<div><div>
<code>

<span class="add">@add(<span class="name">globals)</span></span><br/>
<span class="in1"></span>
<span class="keyword">const</span> <span class="var">$max_msg</span> =<br/>
<span class="in2"></span>
<span class="fn">$</span>(<span class="str">'.max-msg'</span>);<br/>

<span class="end">@end(<span class="name">globals)</span></span><br/>
</code>
</div>
<ul><li>
 Felder enthalten die größte mögliche Zahl für eine Nachricht</li></ul></div>
<div><div>
<code>

<span class="add">@add(<span class="name">refresh)</span></span><br/>
<span class="in1"></span>
<span class="keyword">const</span> <span class="var">one</span> = <span class="fn">bigInt</span>.<span class="var">one</span>;<br/>
<span class="in1"></span>
<span class="keyword">const</span> <span class="var">max_msg</span> =<br/>
<span class="in2"></span>
<span class="var">public_key</span>.<span class="fn">subtract</span>(<span class="var">one</span>);<br/>
<span class="in1"></span>
<span class="var">$max_msg</span>.<span class="fn">text</span>(<br/>
<span class="in2"></span>
<span class="var">max_msg</span>.<span class="fn">toString</span>()<br/>
<span class="in1"></span>
);<br/>

<span class="end">@end(<span class="name">refresh)</span></span><br/>
</code>
</div>
<ul><li>
 Die größte mögliche Nachrichtenzahl wird in Fehlermeldungen benötigt</li></ul></div>
<div><div>
<code>

<span class="add">@add(<span class="name">globals)</span></span><br/>
<span class="in1"></span>
<span class="keyword">const</span> <span class="var">$phi</span> = <span class="fn">$</span>(<span class="str">'#phi'</span>);<br/>

<span class="end">@end(<span class="name">globals)</span></span><br/>
</code>
</div>
<ul><li>
 Auch das Ergebnis der φ-Funktion wird auf der Webseite angezeigt</li></ul></div>
<div><div>
<code>

<span class="add">@add(<span class="name">refresh)</span></span><br/>
<span class="in1"></span>
<span class="keyword">const</span> <span class="var">phi</span> = <span class="var">prime1</span>.<span class="fn">subtract</span>(<span class="var">one</span>).<br/>
<span class="in2"></span>
<span class="fn">multiply</span>(<span class="var">prime2</span>.<span class="fn">subtract</span>(<span class="var">one</span>));<br/>
<span class="in1"></span>
<span class="var">$phi</span>.<span class="fn">text</span>(<span class="var">phi</span>.<span class="fn">toString</span>());<br/>

<span class="end">@end(<span class="name">refresh)</span></span><br/>
</code>
</div>
<ul><li>
 Da davon ausgegangen wird, dass die beiden Primzahlen verschieden
  sind, ist das Produkt von deren Vorgänger der Wert der φ-Funktion
  des öffentlichen Schlüssels</li></ul></div>
<div><div>
<code>

<span class="add">@add(<span class="name">globals)</span></span><br/>
<span class="in1"></span>
<span class="keyword">const</span> <span class="fn">gcd</span> = (<span class="var">a</span>, <span class="var">b</span>) =&gt; {<br/>
<span class="in2"></span>
<span class="expand">@expand(<span class="name">gcd)</span></span>;<br/>
<span class="in1"></span>
};<br/>

<span class="end">@end(<span class="name">globals)</span></span><br/>
</code>
</div>
<ul><li>
 Das inverse Element kann mit dem Erweiterten Euklidischen Algorithmus
  berechnet werden</li><li>
 Dieser wird weiter unten implementiert</li></ul></div>
<div><div>
<code>

<span class="add">@add(<span class="name">globals)</span></span><br/>
<span class="in1"></span>
<span class="keyword">const</span> <span class="var">$e</span> = <span class="fn">$</span>(<span class="str">'#base'</span>);<br/>
<span class="in1"></span>
<span class="keyword">const</span> <span class="var">$gcd</span> = <span class="fn">$</span>(<span class="str">'#gcd'</span>);<br/>
<span class="in1"></span>
<span class="keyword">const</span> <span class="var">$errGcdNot1</span> =<br/>
<span class="in2"></span>
<span class="fn">$</span>(<span class="str">'#err-gcd-not-1'</span>);<br/>

<span class="end">@end(<span class="name">globals)</span></span><br/>
</code>
</div>
<ul><li>
 Der Wert <code><span class="var">e</span></code> wird wie die Primzahlen aus einem Textfeld ausgelesen</li><li>
 Der größte gemeinsame Teiler wird zur Kontrolle auch angezeigt</li><li>
 Es gibt eine Fehlermeldung, wenn der größte gemeinsame Teiler nicht
  <code><span class="num">1</span></code> ist</li></ul></div>
<div><div>
<code>

<span class="add">@add(<span class="name">refresh)</span></span><br/>
<span class="in1"></span>
<span class="keyword">const</span> <span class="var">e</span> = <span class="fn">bigInt</span>(<span class="var">$e</span>.<span class="fn">val</span>());<br/>
<span class="in1"></span>
<span class="keyword">const</span> <span class="var">gg</span> = <span class="fn">gcd</span>(<span class="var">phi</span>, <span class="var">e</span>);<br/>
<span class="in1"></span>
<span class="var">$errGcdNot1</span>.<span class="fn">toggleClass</span>(<br/>
<span class="in2"></span>
<span class="str">'hidden'</span>, <span class="var">gg</span>.<span class="var">a</span>.<span class="fn">equals</span>(<span class="num">1</span>)<br/>
<span class="in1"></span>
);<br/>
<span class="in1"></span>
<span class="var">$gcd</span>.<span class="fn">text</span>(<span class="var">gg</span>.<span class="var">a</span>.<span class="fn">toString</span>());<br/>

<span class="end">@end(<span class="name">refresh)</span></span><br/>
</code>
</div>
<ul><li>
 Wenn <code><span class="var">e</span></code> und der Wert der φ-Funktion nicht teilerfremd sind, wird
  eine entsprechende Fehlermeldung angezeigt</li></ul></div>
<div><div>
<code>

<span class="add">@add(<span class="name">globals)</span></span><br/>
<span class="in1"></span>
<span class="keyword">const</span> <span class="var">$private_key</span> = <span class="fn">$</span>(<span class="str">'#private-key'</span>);<br/>

<span class="end">@end(<span class="name">globals)</span></span><br/>
</code>
</div>
<ul><li>
 Der private Schlüssel wird auch auf der Webseite ausgegeben</li></ul></div>
<div><div>
<code>

<span class="add">@add(<span class="name">refresh)</span></span><br/>
<span class="in1"></span>
<span class="keyword">let</span> <span class="var">private_key</span> = <span class="var">gg</span>.<span class="var">v</span>;<br/>
<span class="in1"></span>
<span class="keyword">if</span> (<span class="var">private_key</span>.<span class="fn">lesser</span>(<span class="num">0</span>)) {<br/>
<span class="in2"></span>
<span class="var">private_key</span> = <span class="var">private_key</span>.<span class="fn">add</span>(<span class="var">phi</span>);<br/>
<span class="in1"></span>
}<br/>
<span class="in1"></span>
<span class="var">$private_key</span>.<span class="fn">text</span>(<span class="var">private_key</span>.<span class="fn">toString</span>());<br/>

<span class="end">@end(<span class="name">refresh)</span></span><br/>
</code>
</div>
<ul><li>
 Der private Schlüssel ist das multiplikative Inverse modulo φ</li></ul></div>
<div><div>
<code>

<span class="add">@add(<span class="name">globals)</span></span><br/>
<span class="in1"></span>
<span class="keyword">let</span> <span class="var">encrypt</span> = <span class="keyword">true</span>;<br/>

<span class="end">@end(<span class="name">globals)</span></span><br/>
</code>
</div>
<ul><li>
 Der Algorithmus kann sowohl ver- als auch entschlüsseln</li><li>
 Die Variable <code><span class="var">encrypt</span></code> bestimmt, in welche Richtung der Algorithmus
  läuft</li></ul></div>
<div><div>
<code>

<span class="add">@add(<span class="name">refresh)</span></span><br/>
<span class="in1"></span>
<span class="keyword">if</span> (<span class="var">encrypt</span>) {<br/>
<span class="in2"></span>
<span class="expand">@expand(<span class="name">encrypt)</span></span>;<br/>
<span class="in1"></span>
} <span class="keyword">else</span> {<br/>
<span class="in2"></span>
<span class="expand">@expand(<span class="name">decrypt)</span></span>;<br/>
<span class="in1"></span>
}<br/>

<span class="end">@end(<span class="name">refresh)</span></span><br/>
</code>
</div>
<ul><li>
 Je nachdem, in welche Richtung der Algorithmus arbeiten soll, wird
  entweder der Klartext verschlüsselt</li><li>
 Oder der Geheimtext entschlüsselt</li></ul></div>
<div><div>
<code>

<span class="add">@add(<span class="name">globals)</span></span><br/>
<span class="in1"></span>
<span class="keyword">const</span> <span class="var">$private_message</span> =<br/>
<span class="in2"></span>
<span class="fn">$</span>(<span class="str">'#private-message'</span>);<br/>
<span class="in1"></span>
<span class="keyword">const</span> <span class="var">$public_message</span> =<br/>
<span class="in2"></span>
<span class="fn">$</span>(<span class="str">'#public-message'</span>);<br/>
<span class="in1"></span>
<span class="keyword">const</span> <span class="var">$errPublicMsgTooBig</span> =<br/>
<span class="in2"></span>
<span class="fn">$</span>(<span class="str">'#err-public-msg-too-big'</span>);<br/>
<span class="in1"></span>
<span class="keyword">const</span> <span class="var">$errPrivateMsgTooBig</span> =<br/>
<span class="in2"></span>
<span class="fn">$</span>(<span class="str">'#err-private-msg-too-big'</span>);<br/>

<span class="end">@end(<span class="name">globals)</span></span><br/>
</code>
</div>
<ul><li>
 Es gibt ein Textfeld für den Klartext und den Geheimtext</li><li>
 Zu jedem Feld gibt es eine Fehlermeldung, wenn die eingegebene Zahl zu
  groß ist</li></ul></div>
<div><div>
<code>

<span class="add">@def(<span class="name">encrypt)</span></span><br/>
<span class="in1"></span>
<span class="keyword">const</span> <span class="var">source</span> =<br/>
<span class="in2"></span>
<span class="fn">bigInt</span>(<span class="var">$private_message</span>.<span class="fn">val</span>());<br/>
<span class="in1"></span>
<span class="var">$errPublicMsgTooBig</span>.<span class="fn">toggleClass</span>(<br/>
<span class="in2"></span>
<span class="str">'hidden'</span>,<br/>
<span class="in2"></span>
<span class="var">source</span>.<span class="fn">lesser</span>(<span class="var">public_key</span>)<br/>
<span class="in1"></span>
);<br/>
<span class="in1"></span>
<span class="var">$errPrivateMsgTooBig</span>.<span class="fn">addClass</span>(<br/>
<span class="in2"></span>
<span class="str">'hidden'</span><br/>
<span class="in1"></span>
);<br/>

<span class="end">@end(<span class="name">encrypt)</span></span><br/>
</code>
</div>
<ul><li>
 Beim Verschlüsseln wird geprüft, ob der Klartext zu groß ist</li><li>
 Dann wird eine Fehlermeldung angezeigt</li><li>
 Beim Entschlüsseln gibt es eine anloge Fehlermeldung, die beim
  Verschlüsseln immer ausgeblendet wird</li></ul></div>
<div><div>
<code>

<span class="add">@add(<span class="name">encrypt)</span></span><br/>
<span class="in1"></span>
<span class="keyword">const</span> <span class="var">encrypted</span> = <span class="var">source</span>.<span class="fn">modPow</span>(<br/>
<span class="in2"></span>
<span class="var">e</span>, <span class="var">public_key</span><br/>
<span class="in1"></span>
);<br/>
<span class="in1"></span>
<span class="var">$public_message</span>.<span class="fn">val</span>(<br/>
<span class="in2"></span>
<span class="var">encrypted</span>.<span class="fn">toString</span>()<br/>
<span class="in1"></span>
);<br/>

<span class="end">@end(<span class="name">encrypt)</span></span><br/>
</code>
</div>
<ul><li>
 Das Verschlüsseln besteht nur aus einer Exponentiation mit <code><span class="var">e</span></code>
  modulo <code><span class="var">N</span></code> (dem öffentlichen Schlüssel)</li></ul></div>
<div><div>
<code>

<span class="add">@def(<span class="name">decrypt)</span></span><br/>
<span class="in1"></span>
<span class="keyword">const</span> <span class="var">source</span> =<br/>
<span class="in2"></span>
<span class="fn">bigInt</span>(<span class="var">$public_message</span>.<span class="fn">val</span>());<br/>
<span class="in1"></span>
<span class="var">$errPublicMsgTooBig</span>.<span class="fn">addClass</span>(<br/>
<span class="in2"></span>
<span class="str">'hidden'</span><br/>
<span class="in1"></span>
);<br/>
<span class="in1"></span>
<span class="var">$errPrivateMsgTooBig</span>.<span class="fn">toggleClass</span>(<br/>
<span class="in2"></span>
<span class="str">'hidden'</span>,<br/>
<span class="in2"></span>
<span class="var">source</span>.<span class="fn">lesser</span>(<span class="var">public_key</span>)<br/>
<span class="in1"></span>
);<br/>

<span class="end">@end(<span class="name">decrypt)</span></span><br/>
</code>
</div>
<ul><li>
 Beim Entschlüsseln wird der Geheimtext als Eingabe verwendet</li><li>
 Auch hier wird eine Fehlermeldung ausgegeben, wenn die Zahl zu groß
  ist</li><li>
 Beim Verschlüsseln gibt es eine anloge Fehlermeldung, die beim
  Entschlüsseln immer ausgeblendet wird</li></ul></div>
<div><div>
<code>

<span class="add">@add(<span class="name">decrypt)</span></span><br/>
<span class="in1"></span>
<span class="keyword">const</span> <span class="var">decrypted</span> = <span class="var">source</span>.<span class="fn">modPow</span>(<br/>
<span class="in2"></span>
<span class="var">private_key</span>, <span class="var">public_key</span><br/>
<span class="in1"></span>
);<br/>
<span class="in1"></span>
<span class="var">$private_message</span>.<span class="fn">val</span>(<br/>
<span class="in2"></span>
<span class="var">decrypted</span>.<span class="fn">toString</span>()<br/>
<span class="in1"></span>
);<br/>

<span class="end">@end(<span class="name">decrypt)</span></span><br/>
</code>
</div>
<ul><li>
 Auch das Entschlüsseln besteht aus einer einzigen Exponentiation mit
  dem geheimen Schlüssel <code><span class="var">d</span></code> modulo <code><span class="var">N</span></code></li></ul></div>
</div>
<h1>Größter gemeinsamer Teiler (ggT)</h1>
<div class="slides">
<div><div>
<h1>Größter gemeinsamer Teiler (ggT)</h1>
</div>
<ul><li>
 Leider bietet die verwendete Mathe-Bibliothek keinen Algorithmus, um
  das Inverse Element zu einer Restklasse zu bestimmen</li><li>
 Daher wird der Erweiterte Euklidische Algorithmus hier direkt
  implementiert</li></ul></div>
<div><div>
<code>

<span class="add">@def(<span class="name">gcd)</span></span><br/>
<span class="in1"></span>
<span class="keyword">let</span> <span class="var">ca</span> = <span class="var">a</span>;<br/>
<span class="in1"></span>
<span class="keyword">let</span> <span class="var">cb</span> = <span class="var">b</span>;<br/>

<span class="end">@end(<span class="name">gcd)</span></span><br/>
</code>
</div>
<ul><li>
 Die aktuellen Werte von <code><span class="var">a</span></code> und <code><span class="var">b</span></code> werden in <code><span class="var">ca</span></code> und
  <code><span class="var">cb</span></code> gespeichert</li><li>
 Solange <code><span class="var">cb</span></code> nicht <code><span class="num">0</span></code> ist gilt stets, dass der größte
  gemeinsame Teiler von <code><span class="var">a</span></code> und <code><span class="var">b</span></code> auch der größte gemeinsame
  Teiler von <code><span class="var">ca</span></code> und <code><span class="var">cb</span></code> ist</li><li>
 Der Euklidische Algorithmus reduziert <code><span class="var">ca</span></code> und <code><span class="var">cb</span></code>, bis
  <code><span class="var">cb</span></code> gleich <code><span class="num">0</span></code> wird</li></ul></div>
<div><div>
<code>

<span class="add">@add(<span class="name">gcd)</span></span><br/>
<span class="in1"></span>
<span class="keyword">let</span> <span class="var">u</span> = <span class="fn">bigInt</span>.<span class="var">one</span>;<br/>
<span class="in1"></span>
<span class="keyword">let</span> <span class="var">v</span> = <span class="fn">bigInt</span>.<span class="var">zero</span>;<br/>
<span class="in1"></span>
<span class="keyword">let</span> <span class="var">s</span> = <span class="var">v</span>;<br/>
<span class="in1"></span>
<span class="keyword">let</span> <span class="var">t</span> = <span class="var">u</span>;<br/>

<span class="end">@end(<span class="name">gcd)</span></span><br/>
</code>
</div>
<ul><li>
 Der Erweiterte Euklidische Algorithmus enthält vier weitere Parameter
  <code><span class="var">u</span></code>, <code><span class="var">v</span></code>, <code><span class="var">s</span></code> und <code><span class="var">t</span></code></li><li>
 Es gilt stets, dass <code><span class="var">ca</span> = <span class="var">u</span> * <span class="var">a</span> + <span class="var">v</span> * <span class="var">b</span></code></li><li>
 Und <code><span class="var">cb</span> = <span class="var">s</span> * <span class="var">a</span> + <span class="var">t</span> * <span class="var">b</span></code></li></ul></div>
<div><div>
<code>

<span class="add">@add(<span class="name">gcd)</span></span><br/>
<span class="in1"></span>
<span class="keyword">while</span> (! <span class="var">cb</span>.<span class="fn">isZero</span>()) {<br/>
<span class="in2"></span>
<span class="expand">@expand(<span class="name">gcd loop)</span></span>;<br/>
<span class="in1"></span>
}<br/>

<span class="end">@end(<span class="name">gcd)</span></span><br/>
</code>
</div>
<ul><li>
 Solange <code><span class="var">cb</span></code> nicht <code><span class="num">0</span></code> ist, wird die Schleife ausgeführt</li></ul></div>
<div><div>
<code>

<span class="add">@def(<span class="name">gcd loop)</span></span><br/>
<span class="in1"></span>
<span class="keyword">const</span> <span class="var">dd</span> = <span class="var">ca</span>.<span class="fn">divmod</span>(<span class="var">cb</span>);<br/>
<span class="in1"></span>
<span class="keyword">const</span> <span class="var">na</span> = <span class="var">cb</span>;<br/>
<span class="in1"></span>
<span class="keyword">const</span> <span class="var">nb</span> = <span class="var">dd</span>.<span class="var">remainder</span>;<br/>

<span class="end">@end(<span class="name">gcd loop)</span></span><br/>
</code>
</div>
<ul><li>
 <code><span class="var">ca</span></code> wird durch <code><span class="var">cb</span></code> geteilt</li><li>
 Der neue Wert von <code><span class="var">ca</span></code> (<code><span class="var">na</span></code>) wird auf <code><span class="var">cb</span></code> gesetzt</li><li>
 Der neue Wert von <code><span class="var">cb</span></code> (<code><span class="var">nb</span></code>) ist der Rest aus der Division</li><li>
 Der größte gemeinsame Teiler von <code><span class="var">ca</span></code> und <code><span class="var">cb</span></code> ist auch der
  größte gemeinsame Teiler von <code><span class="var">na</span></code> und <code><span class="var">nb</span></code></li></ul></div>
<div><div>
<code>

<span class="add">@add(<span class="name">gcd loop)</span></span><br/>
<span class="in1"></span>
<span class="keyword">const</span> <span class="var">nu</span> = <span class="var">s</span>;<br/>
<span class="in1"></span>
<span class="keyword">const</span> <span class="var">nv</span> = <span class="var">t</span>;<br/>

<span class="end">@end(<span class="name">gcd loop)</span></span><br/>
</code>
</div>
<ul><li>
 Dadurch, dass <code><span class="var">cb</span></code> nach <code><span class="var">na</span></code> kopiert wurde, können die
  Koeffizienten <code><span class="var">s</span></code> und <code><span class="var">t</span></code> nach <code><span class="var">nu</span></code> und <code><span class="var">nv</span></code> kopiert
  werden</li></ul></div>
<div><div>
<code>

<span class="add">@add(<span class="name">gcd loop)</span></span><br/>
<span class="in1"></span>
<span class="keyword">const</span> <span class="var">ns</span> =<br/>
<span class="in2"></span>
<span class="var">u</span>.<span class="fn">subtract</span>(<span class="var">dd</span>.<span class="var">quotient</span>.<span class="fn">multiply</span>(<span class="var">s</span>));<br/>
<span class="in1"></span>
<span class="keyword">const</span> <span class="var">nt</span> =<br/>
<span class="in2"></span>
<span class="var">v</span>.<span class="fn">subtract</span>(<span class="var">dd</span>.<span class="var">quotient</span>.<span class="fn">multiply</span>(<span class="var">t</span>));<br/>

<span class="end">@end(<span class="name">gcd loop)</span></span><br/>
</code>
</div>
<ul><li>
 Aus den aktuellen <code><span class="var">u</span></code> und <code><span class="var">v</span></code> können die neuen <code><span class="var">s</span></code> und
  <code><span class="var">t</span></code> bestimmt werden</li></ul></div>
<div><div>
<code>

<span class="add">@add(<span class="name">gcd loop)</span></span><br/>
<span class="in1"></span>
<span class="var">ca</span> = <span class="var">na</span>;<br/>
<span class="in1"></span>
<span class="var">cb</span> = <span class="var">nb</span>;<br/>

<span class="end">@end(<span class="name">gcd loop)</span></span><br/>
</code>
</div>
<ul><li>
 Die neuen Werte werden zu den aktuellen Werten</li></ul></div>
<div><div>
<code>

<span class="add">@add(<span class="name">gcd loop)</span></span><br/>
<span class="in1"></span>
<span class="var">u</span> = <span class="var">nu</span>;<br/>
<span class="in1"></span>
<span class="var">v</span> = <span class="var">nv</span>;<br/>
<span class="in1"></span>
<span class="var">s</span> = <span class="var">ns</span>;<br/>
<span class="in1"></span>
<span class="var">t</span> = <span class="var">nt</span>;<br/>

<span class="end">@end(<span class="name">gcd loop)</span></span><br/>
</code>
</div>
<ul><li>
 Die neuen Werte werden zu den aktuellen Werten</li></ul></div>
<div><div>
<code>

<span class="add">@add(<span class="name">gcd)</span></span><br/>
<span class="in1"></span>
<span class="keyword">return</span> {<br/>
<span class="in2"></span>
<span class="str">a</span>: <span class="var">ca</span>, <span class="str">u</span>: <span class="var">u</span>, <span class="str">v</span>: <span class="var">v</span>,<br/>
<span class="in2"></span>
<span class="str">s</span>: <span class="var">s</span>, <span class="str">t</span>: <span class="var">t</span> <br/>
<span class="in1"></span>
};<br/>

<span class="end">@end(<span class="name">gcd)</span></span><br/>
</code>
</div>
<ul><li>
 Zurück liefert die Funktion den größten gemeinsamen Teiler <code><span class="var">a</span></code></li><li>
 Und die Koeffizienten</li></ul></div>
</div>
<h2>Unit-Test</h2>
<div class="slides">
<div><div>
<h2>Unit-Test</h2>
</div>
</div>
<div><div>
<code>

<span class="add">@add(<span class="name">globals)</span></span> {<br/>
<span class="in1"></span>
<span class="expand">@expand(<span class="name">unit test)</span></span>;<br/>

} <span class="end">@end(<span class="name">globals)</span></span><br/>
</code>
</div>
<ul><li>
 Unit-Test wird in einem eigenen Block bei jedem Start ausgeführt</li></ul></div>
<div><div>
<code>

<span class="add">@def(<span class="name">unit test)</span></span><br/>
<span class="in1"></span>
<span class="keyword">const</span> <span class="fn">eq</span> = (<span class="var">a</span>, <span class="var">b</span>) =&gt; {<br/>
<span class="in2"></span>
<span class="keyword">if</span> (!<span class="var">a</span>.<span class="fn">equals</span>(<span class="var">b</span>)) {<br/>
<span class="in3"></span>
<span class="var">console</span>.<span class="fn">error</span>(<br/>
<span class="in4"></span>
<span class="str">`expected </span>${<span class="var">a</span>}<span class="str">, got </span>${<span class="var">b</span>}<span class="str">`</span><br/>
<span class="in3"></span>
);<br/>
<span class="in2"></span>
}<br/>
<span class="in1"></span>
};<br/>

<span class="end">@end(<span class="name">unit test)</span></span><br/>
</code>
</div>
<ul><li>
 Die Funktion prüft, ob zwei große Zahlen gleich sind</li></ul></div>
<div><div>
<code>

<span class="add">@add(<span class="name">unit test)</span></span><br/>
<span class="in1"></span>
<span class="keyword">const</span> <span class="var">g</span> = <span class="fn">gcd</span>(<br/>
<span class="in2"></span>
<span class="fn">bigInt</span>(<span class="num">70</span>), <span class="fn">bigInt</span>(<span class="num">4</span>)<br/>
<span class="in1"></span>
);<br/>
<span class="in1"></span>
<span class="fn">eq</span>(<span class="var">g</span>.<span class="var">a</span>, <span class="fn">bigInt</span>(<span class="num">2</span>));<br/>

<span class="end">@end(<span class="name">unit test)</span></span><br/>
</code>
</div>
<ul><li>
 Der größte gemeinsame Teiler muss <code><span class="num">2</span></code> sein</li></ul></div>
<div><div>
<code>

<span class="add">@add(<span class="name">unit test)</span></span><br/>
<span class="in1"></span>
<span class="fn">eq</span>(<span class="var">g</span>.<span class="var">u</span>, <span class="fn">bigInt</span>(<span class="num">1</span>));<br/>
<span class="in1"></span>
<span class="fn">eq</span>(<span class="var">g</span>.<span class="var">v</span>, <span class="fn">bigInt</span>(<span class="num">-17</span>));<br/>

<span class="end">@end(<span class="name">unit test)</span></span><br/>
</code>
</div>
<ul><li>
 Die Koeffizienten <code><span class="var">g</span>.<span class="var">u</span></code> und <code><span class="var">g</span>.<span class="var">v</span></code> liefern
  eine Linearkombination für den größten gemeinsamen Teiler</li></ul></div>
<div><div>
<code>

<span class="add">@add(<span class="name">unit test)</span></span><br/>
<span class="in1"></span>
<span class="fn">eq</span>(<span class="var">g</span>.<span class="var">s</span>, <span class="fn">bigInt</span>(<span class="num">-2</span>));<br/>
<span class="in1"></span>
<span class="fn">eq</span>(<span class="var">g</span>.<span class="var">t</span>, <span class="fn">bigInt</span>(<span class="num">35</span>));<br/>

<span class="end">@end(<span class="name">unit test)</span></span><br/>
</code>
</div>
<ul><li>
 Die Koeffizienten <code><span class="var">g</span>.<span class="var">s</span></code> und <code><span class="var">g</span>.<span class="var">t</span></code> liefern nicht-triviale
  Linearkombination von <code><span class="num">0</span></code></li><li>
 Also <code><span class="var">g</span>.<span class="var">s</span> * <span class="num">70</span> + <span class="var">g</span>.<span class="var">t</span> * <span class="num">4</span> == 0</code> wobei <code><span class="var">g</span>.<span class="var">s</span></code> und
  <code><span class="var">g</span>.<span class="var">t</span></code> nicht <code><span class="num">0</span></code> sind</li></ul></div>
</div>
<h1>Richtung des Algorithmus anzeigen</h1>
<div class="slides">
<div><div>
<h1>Richtung des Algorithmus anzeigen</h1>
</div>
<ul><li>
 Es gibt ein Element auf der Web-Seite, das die Ablaufrichtung des
  Algorithmus anzeigt</li><li>
 Ob er ver- oder entschlüsselt</li></ul></div>
<div><div>
<code>

<span class="add">@add(<span class="name">globals)</span></span><br/>
<span class="in1"></span>
<span class="keyword">const</span> <span class="var">$direction</span> =<br/>
<span class="in2"></span>
<span class="fn">$</span>(<span class="str">'#direction'</span>);<br/>

<span class="end">@end(<span class="name">globals)</span></span><br/>
</code>
</div>
<ul><li>
 Dieses Element zeigt die Richtung an, in welcher der Algorithmus
  läuft</li><li>
 Die Richtung wird durch CSS-Klassen visualisiert</li></ul></div>
<div><div>
<code>

<span class="add">@add(<span class="name">setup rsa)</span></span><br/>
<span class="in1"></span>
<span class="keyword">const</span> <span class="fn">setEncrypt</span> = <span class="var">new_encrypt</span> =&gt; {<br/>
<span class="in2"></span>
<span class="keyword">if</span> (<span class="var">encrypt</span> === <span class="var">new_encrypt</span>) {<br/>
<span class="in3"></span>
<span class="keyword">return</span>;<br/>
<span class="in2"></span>
}<br/>
<span class="in2"></span>
<span class="var">encrypt</span> = <span class="var">new_encrypt</span>;<br/>
<span class="in2"></span>
<span class="keyword">if</span> (<span class="var">encrypt</span>) {<br/>
<span class="in3"></span>
<span class="var">$direction</span>.<span class="fn">removeClass</span>(<span class="str">'flip'</span>);<br/>
<span class="in3"></span>
<span class="var">$direction</span>.<span class="fn">addClass</span>(<span class="str">'flop'</span>);<br/>
<span class="in2"></span>
} else {<br/>
<span class="in3"></span>
<span class="var">$direction</span>.<span class="fn">removeClass</span>(<span class="str">'flop'</span>);<br/>
<span class="in3"></span>
<span class="var">$direction</span>.<span class="fn">addClass</span>(<span class="str">'flip'</span>);<br/>
<span class="in2"></span>
}<br/>
<span class="in1"></span>
};<br/>

<span class="end">@end(<span class="name">setup rsa)</span></span><br/>
</code>
</div>
<ul><li>
 Durch CSS-Animationen wird der Pfeil hin- und hergedreht</li><li>
 Wenn keine Klasse oder die Klasse <code><span class="str">flop</span></code> gesetzt ist, dann zeigt
  der Pfeil in die Verschlüsselungsrichtung</li><li>
 Wenn die Klasse <code><span class="str">flip</span></code> gesetzt ist, zeigt er in die
  Entschlüsselungsrichtung</li><li>
 <code><span class="str">flop</span></code> ist notwendig, um den Wechsel zu animieren</li></ul></div>
</div>
<h1>Timer</h1>
<div class="slides">
<div><div>
<h1>Timer</h1>
</div>
<ul><li>
 Das Berechnen von RSA kann bei sehr großen Zahlen etwas dauern</li><li>
 Daher wird nicht mit jeder Änderung eine neue Berechnung gestartet</li><li>
 Nur wenn nach der letzten Änderung ein gewisses Zeitintervall
  verstrichen ist, wird die Berechnung gestartet</li></ul></div>
<div><div>
<code>

<span class="add">@add(<span class="name">globals)</span></span><br/>
<span class="in1"></span>
<span class="keyword">let</span> <span class="var">timer</span>;<br/>

<span class="end">@end(<span class="name">globals)</span></span><br/>
</code>
</div>
<ul><li>
 Der Timer wird global vorgehalten</li></ul></div>
<div><div>
<code>

<span class="add">@add(<span class="name">globals)</span></span><br/>
<span class="in1"></span>
<span class="keyword">const</span> <span class="fn">resetTimer</span> = () =&gt; {<br/>
<span class="in2"></span>
<span class="var">timer</span> = <span class="var">null</span>;<br/>
<span class="in1"></span>
};<br/>

<span class="end">@end(<span class="name">globals)</span></span><br/>
</code>
</div>
</div>
<div><div>
<code>

<span class="add">@add(<span class="name">setup rsa)</span></span><br/>
<span class="in1"></span>
<span class="keyword">const</span> <span class="fn">queueRefresh</span> = <span class="var">event</span> =&gt; {<br/>
<span class="in2"></span>
<span class="var">event</span>.<span class="fn">preventDefault</span>();<br/>
<span class="in2"></span>
<span class="keyword">let</span> <span class="fn">fn</span> = <span class="fn">refresh</span>;<br/>
<span class="in2"></span>
<span class="keyword">if</span> (! <span class="var">timer</span>) {<br/>
<span class="in3"></span>
<span class="fn">refresh</span>();<br/>
<span class="in3"></span>
<span class="fn">fn</span> = <span class="fn">resetTimer</span>;<br/>
<span class="in2"></span>
} <span class="keyword">else</span> {<br/>
<span class="in3"></span>
<span class="fn">clearTimeout</span>(<span class="var">timer</span>);<br/>
<span class="in3"></span>
<span class="expand">@expand(<span class="name">set fields to pending)</span></span>;<br/>
<span class="in2"></span>
}<br/>
<span class="in2"></span>
<span class="var">timer</span> = <span class="fn">setTimeout</span>(<span class="fn">fn</span>, <span class="num">500</span>);<br/>
<span class="in1"></span>
}<br/>

<span class="end">@end(<span class="name">setup rsa)</span></span><br/>
</code>
</div>
<ul><li>
 Wenn es noch keine Änderung gab, wird die Änderung sofort
  durchgeführt</li><li>
 Und nach Ablauf des Timers wird keine Neuberechnung durchgeführt</li><li>
 Ansonsten werden die Felder mit Platzhaltern befüllt und der
  bestehende Timer gelöscht</li><li>
 Dann wird eine neuer Timer gestartet, der die Berechnung triggert</li><li>
 Der Timeout beträgt eine halbe Sekunde</li></ul></div>
<div><div>
<code>

<span class="add">@add(<span class="name">refresh)</span></span><br/>
<span class="in1"></span>
<span class="fn">resetTimer</span>();<br/>

<span class="end">@end(<span class="name">refresh)</span></span><br/>
</code>
</div>
<ul><li>
 Nach der Neuberechnung wird der Timer gelöscht</li></ul></div>
<div><div>
<code>

<span class="add">@def(<span class="name">set fields to pending)</span></span><br/>
<span class="in1"></span>
<span class="var">$public_key_length</span>.<span class="fn">text</span>(<span class="str">'...'</span>);<br/>
<span class="in1"></span>
<span class="var">$public_key</span>.<span class="fn">text</span>(<span class="str">'...'</span>);<br/>
<span class="in1"></span>
<span class="var">$phi</span>.<span class="fn">text</span>(<span class="str">'...'</span>);<br/>
<span class="in1"></span>
<span class="var">$gcd</span>.<span class="fn">text</span>(<span class="str">'...'</span>);<br/>
<span class="in1"></span>
<span class="var">$private_key</span>.<span class="fn">text</span>(<span class="str">'...'</span>);<br/>

<br/>
<span class="in1"></span>
<span class="keyword">if</span> (<span class="var">encrypt</span>) {<br/>
<span class="in2"></span>
<span class="var">$public_message</span>.<span class="fn">val</span>(<span class="str">'...'</span>);<br/>
<span class="in1"></span>
} <span class="keyword">else</span> {<br/>
<span class="in2"></span>
<span class="var">$private_message</span>.<span class="fn">val</span>(<span class="str">'...'</span>);<br/>
<span class="in1"></span>
}<br/>

<span class="end">@end(<span class="name">set fields to pending)</span></span><br/>
</code>
</div>
<ul><li>
 Alle berechneten Felder werden mit Platzhaltern befüllt</li></ul></div>
</div>
<h1>Aktionen hinterlegen</h1>
<div class="slides">
<div><div>
<h1>Aktionen hinterlegen</h1>
</div>
<ul><li>
 Zum Schluss werden die definierten Funktionen als Event-Handler
  registriert</li></ul></div>
<div><div>
<code>

<span class="add">@add(<span class="name">setup rsa)</span></span><br/>
<span class="in1"></span>
<span class="var">$prime1</span>.<span class="fn">on</span>(<span class="str">'input'</span>, <span class="fn">queueRefresh</span>);<br/>
<span class="in1"></span>
<span class="var">$prime2</span>.<span class="fn">on</span>(<span class="str">'input'</span>, <span class="fn">queueRefresh</span>);<br/>
<span class="in1"></span>
<span class="var">$e</span>.<span class="fn">on</span>(<span class="str">'input'</span>, <span class="fn">queueRefresh</span>);<br/>

<span class="end">@end(<span class="name">setup rsa)</span></span><br/>
</code>
</div>
<ul><li>
 Werden die Primzahlen oder die Basis geändert, wird die Neuberechnung
  getriggert</li></ul></div>
<div><div>
<code>

<span class="add">@add(<span class="name">setup rsa)</span></span><br/>
<span class="in1"></span>
<span class="var">$private_message</span>.<span class="fn">on</span>(<span class="str">'input'</span>, <span class="var">event</span> =&gt; {<br/>
<span class="in2"></span>
<span class="fn">setEncrypt</span>(<span class="keyword">true</span>);<br/>
<span class="in2"></span>
<span class="fn">queueRefresh</span>(<span class="var">event</span>);<br/>
<span class="in1"></span>
});<br/>
<span class="in1"></span>
<span class="var">$public_message</span>.<span class="fn">on</span>(<span class="str">'input'</span>, <span class="var">event</span> =&gt; {<br/>
<span class="in2"></span>
<span class="fn">setEncrypt</span>(<span class="keyword">false</span>);<br/>
<span class="in2"></span>
<span class="fn">queueRefresh</span>(<span class="var">event</span>);<br/>
<span class="in1"></span>
});<br/>

<span class="end">@end(<span class="name">setup rsa)</span></span><br/>
</code>
</div>
<ul><li>
 Wenn der Klartext oder Geheimtext geändert wird, wird zusätzlich die
  Richtung des Algorithmus angepasst</li></ul></div>
